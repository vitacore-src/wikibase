<!-- TITLE: Генератор выражений -->
<!-- SUBTITLE: Руководство пользователясистемы «ВИТАКОР» -->

# 	Общие сведения о системе
## 	Структура данных

Состав сущностей, их атрибуты и связи между сущностями составляют информационную модель системы, которую определяет разработчик системы на этапе ее проектирования.

Сущность – это логическая модель какого-либо реально существующего объекта – например, организации, физического лица, документа и т.д., факт существования и определенные характеристики которого необходимо учесть в системе.

Атрибут сущности – характеристика, параметр, описывающий определенное свойство сущности. Например, атрибут «Имя» описывает соответствующее свойство сущности «Человек». Описание сущности в системе включает ее наименование, описание всех ее возможных атрибутов, ключи и другие служебные данные.

Каждая сущность имеет ключ – один или несколько атрибутов, однозначно идентифицирующих экземпляр сущности.

Экземпляр сущности - набор конкретных значений атрибутов сущности, которой принадлежит этот экземпляр. Каждый экземпляр сущности имеет уникальный идентификатор (значение ключа). Экземпляры сущности образуют список, структура которого определяется описанием сущности в системе.

Связь между сущностями реализуется с помощью атрибутов-ссылок. Атрибут-ссылка содержит идентификатор элемента (экземпляра) другой сущности. Например, сущность «Страховой полис» должна иметь атрибут-ссылку «Пациент», в котором будет храниться идентификатор пациента, которому принадлежит данный полис.

Таким образом, практически для каждой сущности в базе данных системы существуют:
* 	сущности, на которые она ссылается, или parent-сущности,
* 	сущности, которые ссылаются на нее, или child-сущности.
* 	
Существует еще один вид связей между сущностями – наследование. Наследование означает, что может существовать сущность (сущность-наследник), производная от некоторой базовой сущности (сущность-предок). Производная сущность наследует от базовой ее атрибуты и может дополнительно иметь свои собственные.

Например, существует базовая сущность «Медицинская запись», имеющая атрибуты:
* 	«Идентификатор»,
* 	«Дата записи»,
* 	«Пользователь».
* 	
И существует производная сущность «Амбулаторная медицинская запись», которая будет иметь следующие атрибуты:
* 	«Идентификатор» (унаследован от «Медицинская запись»),
* 	«Дата записи» (унаследован от «Медицинская запись»),
* 	«Пользователь» (унаследован от «Медицинская запись»),
* 	«Амбулаторная карта» (собственный атрибут).

## 	Типы данных
Любое значение в системе (значение атрибута, константное значение, переменная и т.д.) имеет определенный тип. Возможные типы данных приведены в Табл. 1.1.

Атрибут любого типа может иметь значение NULL (т.е. пустое значение). Следует иметь в виду, что для текстовых данных пустая строка «» не является пустым значением, также как и число 0 для числовых данных.

|   ||
|:------------- |:---------------|
|Текст (Text)|Значение, представленное текстовой строкой.|
|Число(целое – Ordinal, дробное – Float)|Числовое значение: целое или дробное (с плавающей точкой) число.|
|Логический (Logical)|Значение, которое может иметь одно из двух состояний: да/нет, или истина/ложь.|
|Дата (DateTime)|Значение, содержащее информацию о дате и времени, т.е. идентифицирующее момент времени.|
|Идентификатор (Guid)|Значение, имеющее тип универсального идентификатора GUID.|
|Объект (Object)|Cложный тип данных (в отличие от перечисленных выше), который может содержать набор элементов различных типов, как простых, так и сложных.|

## 	Вычисляемые атрибуты
Помимо атрибутов, значения которых хранятся в базе данных, существуют атрибуты, значение которых вычисляется в момент отображения списка данных, включения данных в отчет и т.д. Правила вычисления таких атрибутов задаются разработчиком при описании сущности.

Вычисляемые атрибуты могут быть двух типов – простые и параметрические. Значение простого вычисляемого атрибута не зависит от текущего контекста и может быть вычислено без указания каких-либо дополнительных условий (параметров).

Для вычисления параметрического атрибута необходимо запросить значение параметра (или нескольких параметров) у пользователя. Стандартное окно запроса параметров описано в базовом руководстве пользователя, п. 5.2.4.

## 	Пользовательские атрибуты
Кроме атрибутов, созданных на этапе разработки системы, сущности могут содержать дополнительные (пользовательские) атрибуты. Пользовательские атрибуты могут быть добавлены пользователем (администратором) в процессе эксплуатации системы.

Создание пользовательских атрибутов описано в руководстве администратора по настройке системы.
 
# 	Генератор выражений
Выражение представляет собой набор инструкций по произведению определенных действий (операций) над объектами (операндами). Операции различаются по типу операндов и типу результата выполнения операции – логические, арифметические, строковые (текстовые) и т.д. Выражения в системе используются для наложения различных условий на данные при поиске (фильтрации) данных, отборе данных для отчетов, проверке правильности ввода данных и т.д. Для создания и редактирования предназначен специальный программный модуль - генератор выражений. Генератор предоставляет два режима работы:
* 	режим графического конструктора, с которым могут работать пользователи, не знакомые с языками программирования (подраздел 2.2);
* 	режим текстового редактора для создания выражений на языке XML (подраздел 2.7).
* 	
Подраздел 2.1 описывает структуру и правила создания выражений. При этом используется терминология и обозначения, принятые в графическом конструкторе.

## 	Структура выражения
Возможные операции над объектами можно условно разделить на две группы: операции и функции. Деление условное, т.к. функция – тоже операция над данными, но операции и функции, как правило, имеют различное написание (синтаксис):
* 	операция: ОПЕРАНД1 ОПЕРАТОР ОПЕРАНД2,
* 	функция: ФУНКЦИЯ (АРГУМЕНТ1, АРГУМЕНТ2, …).
* 	
Здесь ОПЕРАТОР – это условное обозначение операции, ФУНКЦИЯ – заголовок (имя) функции.

Выражения могут быть вложенными, т.е. в качестве операнда или аргумента может выступать как функция, так и выражение.

В качестве операндов выражений могут выступать объекты, перечисленные в Табл. 2.1. Операнды могут содержать значения (данные) различных типов (типы данных описаны в п. 1.2 Руководства).

Все возможные виды операторов и описание соответствующих им операций приведены в Табл. 2.2, перечень функций – в Табл. 2.3


| Операнд  |Элемент интерфейса конструктора|Описание|
|:------------- |:---------------|:---------------|
|Атрибут сущности|Панель атрибутов	|Общая информация о сущностях и их атрибутах приведена в п. 1 настоящего руководства.<br>Использование атрибутов сущностей в выражениях описано в п.2.3.1.|
|Константное значение (константа)	|Панель инструментов  ![1](/uploads/000003/1.png "1")	|Величина, значение которой не меняется в процессе выполнения программы и фиксируется при создании условия.<br>Применение константных значений описано в п. 2.3.2.|
|Системный параметр	|Панель инструментов  ![2](/uploads/000003/2.png "2")	|Параметр, значение которого определяется в момент вычисления результата выражения. Перечень системных параметров ограничен и создается на этапе разработки системы.<br>Применение системных параметров описано в п. 2.3.3.|
|Пользовательский параметр	|Панель инструментов  ![3](/uploads/000003/3.png "3")	|Пользовательский параметр, значение которого запрашивается приложением у пользователя в момент вычисления результата выражения.<br>Применение пользовательских параметров описано в п. 2.3.4.|

| Элемент интерфейса |Оператор|Тип операнда|Тип результата|Описание|
|:------------- |:---------------|:---------------|:---------------|:---------------|
|![4](/uploads/000003/4.png "4")|Логическое ИЛИ|	Лог.	|Лог.	|Объединение операндов – логических значений или выражений (условий) через «или», т.е. положительным результатом выражения будет выполнение любого из этих условий.|
|![5](/uploads/000003/5.png "5")|Логическое И	|Лог.	|Лог.	|Объединение условий через «и», т.е. положительным результатом выражения будет одновременное выполнение всех этих условий.|
|![6](/uploads/000003/6.png "6")|Похоже	|Строка	|Лог.	|Возвращает положительный результат, если значение удовлетворяет определенному шаблону. Подробное описание оператора и применение шаблонов приведено в п. 2.4.1 Руководства.|
|![7](/uploads/000003/7.png "7")|Равно	|Число, строка	|Лог.	|Точное равенство операндов – чисел, строк, дат и т.д. Регистр символов строки данной операцией игнорируется, т.е. строки «Текст» и «текст» равны.|
|![8](/uploads/000003/8.png "8")|Не равно	|Число, строка	|Лог.	|Операнды не должны быть равны друг другу. В случае строк это означает, что строки не должны совпадать.|
|![9](/uploads/000003/9.png "9")|Меньше или равно	|Число	|Лог.	|Значение первого (левого) операнда должно быть меньше или равно значению второго (правого).|
|![10](/uploads/000003/10.png "10")|Больше или равно	|Число	|Лог.	|Значение первого (левого) операнда должно быть больше или равно значению второго (правого).|
|![11](/uploads/000003/11.png "11")|Меньше	|Число	|Лог.	|Значение первого (левого) операнда должно быть меньше значения второго (правого)|.
|![12](/uploads/000003/12.png "12")|Больше	|Число	|Лог.	|Значение первого (левого) операнда должно быть больше значения второго (правого).|
||IN (Входит в…)	|Любой	|Лог.	|Значение первого операнда должно быть равно значению одного из элементов перечисления (списка значений) второго операнда, см. п. 2.4.2|
||NOT (Не)	|Лог.	|Лог.	|Оператор отрицания, применяется только в связке с другими операторами. См. п.2.4.3.|
||IS	|Объект	|Лог.	|Оператор накладывает условие на сущность, на которую указывает атрибут-ссылка.Подробно см. п.2.4.4.|
||ExactIS	|Объект	|Лог.	|Оператор накладывает условие на сущность, на которую указывает атрибут-ссылка.Подробно см. п.2.4.5.|
|![13](/uploads/000003/13.png "13")|Сложение	|Число, Строка	|Число, Строка	|Арифметический оператор сложения, либо оператор сложения (конкатенации) строк.|
|![14](/uploads/000003/14.png "14")|Вычитание	|Число	|Число	|Арифметический оператор вычитания.|
|![15](/uploads/000003/15.png "15")|Умножение	|Число	|Число	|Арифметический оператор умножения.|
|![16](/uploads/000003/16.png "16")|Деление	|Число	|Число	|Арифметический оператор деления.|
|![17](/uploads/000003/17.png "17")|Скобки	|-	|-	|Скобки определяют очередность вычислений (см. п. 2.3.7).|
|![18](/uploads/000003/18.png "18")|Разность дат	|Дата	|Целое число	|Функция, позволяющая вычислить разность между двумя датами в различных единицах измерения – годах, месяцах, днях и т.д.Применение функции описано в п. 2.5.1.|
|![19](/uploads/000003/19.png "19")|Прибавить к дате	|Дата	|Дата	|Функция, позволяющая вычислить дату путем добавления периода к исходной дате. Период может быть выражен в годах, месяцах, днях и т.д. Применение функции описано в п.2.5.2.|
|![20](/uploads/000003/20.png "20")|Получить часть даты|	Дата	|Целое число	|Функция получения части даты в виде числа (год, месяц, номер недели в году и т.д.).Применение функции описано в п.2.5.3.|
|![21](/uploads/000003/21.png "21")|Подстрока	|Текст	|Текст	|Функция получения заданной части текстовой строки (подстроки).Применение функции описано в п.2.5.4.|
|![22](/uploads/000003/22.png "22")|Длина строки	|Текст	|Целое число	|Функция вычисления длины строки в символах.Применение функции описано в п.2.5.5.|
|![23](/uploads/000003/23.png "23")|Значение функции	|Число	|Число	|Вычисление математической функции. Руководство содержит описание наиболее употребительных функций:<br>•	Получение абсолютного значения (п.2.5.6)|
|![24](/uploads/000003/24.png "24")|Привести к типу	|Любой	|Любой 	|Функция позволяет преобразовать значение аргумента функции к требуемому типу данных.Применение функции описано в п.2.5.7.|
|![25](/uploads/000003/25.png "25")|Удовлет-воряет выражению	|Текст	|Целое число	Функция позволяет анализировать значение аргумента с помощью регулярных выражений.Применение функции описано в п.2.5.8.|
|![26](/uploads/000003/26.png "26")|Условие	|Логический	|Любой	|Позволяет вставить в выражение условную конструкцию вида «Если … тогда … иначе …».Применение функции описано в п.2.5.9.|
|![27](/uploads/000003/27.png "27")|Количество элементов в коллекции	|Объект	|Целое число	|Функция подсчета количества элементов в указанной коллекции элементов типа «Объект».Применение функции описано в п.2.6.1.|
|![28](/uploads/000003/28.png "28")|Выбрать	|Сущ-ность	|Коллекция	|Функция позволяет сделать выборку значений определенного атрибута заданной сущности.Применение функции описано в п.2.6.2.|
|![29](/uploads/000003/29.png "29")|Существует	|Сущ-ность	|Логический	|Функция позволяет проверить факт существования данных сущности, удовлетворяющих определенным условиям.Применение функции описано в п.2.6.3.|
|![30](/uploads/000003/30.png "30")|Поиск по дереву	|Сущ-ность	|Логический	|Функция анализа дерева наследования.Применение функции описано в п.2.6.4.|

## 	Графический конструктор
### 	Интерфейс конструктора

Форма генератора условий в режиме конструктора показана на Рис. 2.1.

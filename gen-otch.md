<!-- TITLE: Генератор отчетов -->
<!-- SUBTITLE: Руководство пользователя системы «ВИТАКОР» -->

# Введение
Настоящее руководство (далее – Руководство) является частью комплекта справочной документации по приложениям компании «Витакор» (далее – приложение, информационная
система, система), содержит описание возможностей и функционала встроенных генераторов отчетов и рассчитано на пользователя, знакомого с базовым руководством пользователя и руководством пользователя по редактору выражений.

Генератор отчетов представляет собой модуль, который является составной частью программных продуктов компании «Витакор». Модуль предназначен для создания форм отчетов и формирования готовых отчетов (заполнение форм данными). Генератор позволяет создавать и редактировать ранее созданные отчеты без привлечения разработчиков системы, силами
подготовленного пользователя или администратора.

Разъяснение по вопросу применяемой терминологии:
В ИТ-среде существует устоявшаяся практика применения термина «Отчет» в двух различных значениях:
* 	отчет, как готовая заполненная данными отчетная форма, в виде бумажного документа или документа в электронном виде (текстовый файл, электронная таблица и др.);
* 	и отчет, как шаблон отчета, т.е. набор инструкций по формированию отчета, предназначенный для использования в программе (например, rpt-файл
программы Crystal Reports и др.).

В настоящем документе там, где значение слова «отчет» может быть истолковано по- разному, термин «отчет» применяется в первом указанном выше значении, а термин
«шаблон отчета» - во втором. Также, при упоминании словосочетания «формирование отчета» имеется в виду первое значение, т.е. формирование данных отчета, а «создание отчета» означает процесс создания, настройки шаблона отчета, в соответствии с которым будет формироваться отчет, т.е. отбираться и обрабатываться его данные.

# 	Общие сведения
Отчет – документ, формируемый на основе данных, хранящихся в БД приложения. Как правило, отчет имеет форму таблицы (или нескольких таблиц), и даже если отчет имеет нетабличную выходную форму, его данные всегда могут быть представлены в виде таблицы.

На Рис. 1.1 показана структура отчета на примере Формы 12 «Сведения о числе заболеваний,
зарегистрированных у больных…». Практически любой отчет имеет аналогичную структуру. В более простом случае отчет может состоять только из одного вложенного отчета и может не иметь
заголовков строк.

![1](/uploads/0-gen-otch/1.png "1")


В системе реализованы два инструмента создания отчетов:
* 	Генератор списочных отчетов;
* 	Генератор универсальный.

Каждый из генераторов реализует следующие функции:
* 	ведение списка отчетов;
* 	создание, редактирование и сохранение в БД шаблона отчета;
* 	создание/подключение шаблона печатной формы отчета (допустимые форматы описаны в п. 1.3);
* 	выгрузка шаблона отчета в файл и загрузка из файла;
* 	настройка прав на отчет для ролей пользователей системы;
* 	формирование отчета по заданному шаблону на основании данных БД
1. 	в виде интерактивной формы в составе приложения;
2. 	в виде электронного документа, открываемого с помощью сторонней программы, соответствующей типу выходного файла (MS Excel, MS Word).

Файл шаблона отчета может быть загружен в БД другой инсталляции приложения и использован для формирования отчетов **без возможности редактирования шаблона.**

Процесс разработки отчета включает следующие этапы:
* 	разработка шаблона отчета с помощью генератора, встроенного в приложение, и сохранение его в БД системы;
* 	разработка шаблона печатной формы отчета с помощью соответствующего приложения (MS Word или MS Excel).

## 	Генератор списочных отчетов
Генератор т.н. «списочных» отчетов – это самое простое средство создания отчета. Структура и внешний вид списочного отчета определяются шаблоном отчета, созданным с помощью внешней
программы – например, MS Office (.doc, .docx, .xls, xlsx). В шаблоне списочного отчета в приложении задается сущность, данные которой будут использованы при формировании отчета, правило отбора данных сущности и права доступа к отчету. Наполнение шаблона списочного отчета
данными определяется т.н. управляющими инструкциями, включенными в шаблон.

Использование генератора списочных отчетов описано в п. 3 настоящего руководства.

## 	Генератор отчетов
В табличной форме данные выводятся в направлении т.н. «осей» отчета – заголовки колонок представляют собой одну ось (ось X), заголовки строк – другую ось (ось Y). Двумерный отчет
содержит две оси вывода данных (обычная таблица), трехмерный – три и т.д. Т.о. каждая из «осей» отчета содержит определенный набор показателей, значения которых будут отбираться и/или
вычисляться в процессе формирования отчета и выводиться в ячейках таблицы, соответствующих области данных. Наименования этих показателей выводятся в качестве заголовков столбцов (в
случае оси X), строк (ось Y) таблицы.

**Способы отображения дополнительных осей отчета.**

Вышесказанное проиллюстрировано Рис. 1.2, где показан образец структуры вложенного отчета, описанный в терминах генератора отчетов.

![2](/uploads/0-gen-otch/2.png "2")

Каждой «оси» отчета соответствует т.н. «Группировщик»: сущность, описывающая структуру оси – количество показателей, порядок их следования и группировку.
Группировщик, в свою очередь, содержит составные элементы – группы, соответствующие заголовкам и подзаголовкам строк или столбцов отчета. Из схемы видно, что группы могут иметь иерархические связи между собой. Каждый группировщик связывается с определенностью сущностью БД системы и для каждой его группы указываются правила отбора данных и расчета значения.

На пересечении групп по различным осям отчета, в области данных, располагаются собственно данные отчета. Содержимое ячейки отчета на пересечении областей данных групп определяется правилами, заданными для этих групп.

Руководствуясь данным описанием структуры отчета можно выделить следующий перечень и последовательность разработки составных элементов отчета:
* 	Вложенные отчеты;
* 	Для каждого вложенного отчета: группировщики, их количество, расположение;
* 	Для каждого группировщика: группы, их количество и отношения между ними.

Важно для всех элементов отчета подобрать информативные наименования для того, чтобы в дальнейшем, при использовании и редактировании отчета можно было легко читать его структуру.

Генератор универсальный (далее – просто «генератор»), описан на примере процесса создания нового отчета в п. 3.4.


## 	Допустимые форматы отчета

**-	документа MS Word (.doc);<br>-	электронной таблицы MS Excel (.xls);<br>-	документа HTML;<br>-	текстового документа.<br>
Для возможности создания шаблона отчета на компьютере пользователя должна быть установлена программа, соответствующая требуемому формату отчета.**

# 	Ведение справочника отчетов
Ведение справочника отчетов, подключенных к приложению, ведется с помощью раздела «Отчеты» панели структуры приложения. Двойной щелчок мышью на корневом элементе ветки («Отчеты») открывает перечень списочных отчетов. Вложенные элементы папки «Отчеты» соответствуют отчетам, созданным с помощью универсального генератора:
* 	«Генератор отчетов» содержит полный перечень отчетов,
* 	«Отчеты из файла» отображает список импортированных отчетов.
* 	
Списки отчетов ведутся с помощью стандартной табличной формы, где панель инструментов формы содержит кнопки для стандартных функций управления списком (создание, удаление и т.д.). Список «Генератор отчетов» имеет относительно стандартного набора функций дополнительные, описанные в таблице ниже.

| Кнопка  | Функция  | Описание |
|:------------- |:---------------:| -------------:|
|![3](/uploads/0-gen-otch/3.png "3")|Сохранить в файл	|Экспорт выделенного в списке шаблона отчета в файл формата XML (см. п.2.1).|
|![4](/uploads/0-gen-otch/4.png "4")|Загрузить из файла	|Импорт файла шаблона отчета в виде XML-файла (см. п.2.2).|


## 	Экспорт отчета
Отчет, созданный с помощью универсального генератора, может быть экспортирован в файл для последующего импорта – например, в другой инсталляции данного приложения. Файл отчета
имеет формат XML и соответствующее расширение.

Команда экспорта шаблона отчета в файл (пиктограмма	![3](/uploads/0-gen-otch/3.png "3")) доступна с помощью панели
инструментов приложения, а также в контекстном меню строки списка. При выборе команды открывается стандартный диалог сохранения файла ОС Windows, в котором необходимо указать папку, в которую следует сохранить файл.

## 	Импорт отчета
Отчет, созданный с помощью универсального генератора отчетов и выгруженный из приложения в файл, может быть загружен (импортирован) для последующего использования без возможности редактирования, т.е. внесения изменений в шаблон отчета. Кнопка импорта шаблона отчета из файла (![4](/uploads/0-gen-otch/4.png "4")	) расположена на панели инструментов приложения. При выборе команды открывается стандартный диалог открытия файла ОС Windows, в котором необходимо указать требуемый файл отчета.

Пользователи смогут формировать импортированный отчет после того, как им будут предоставлены права на данный отчет. Указанный отчет появится в списке доступных для формирования отчетов после предо.


# 	Генератор списочных отчетов
Для создания нового отчета необходимо на панели структуры приложения выбрать папку «Отчеты» и в открывшемся списке отчетов добавить новый элемент с помощью кнопки панели инструментов или контекстного меню списка.

Форма редактирования списочного отчета показана на Рис. 3.1.

![5](/uploads/0-gen-otch/5.png "5")

Форма редактирования состоит из трех вкладок:
* 	«Отчет» - содержит основные данные шаблона отчета;
* 	«Данные» – предназначена для настройки фильтра отбора данных для отчета (создания выборки);
* 	«Права» - предназначена для настройки прав доступа к отчету.
* 	
Состав реквизитов вкладки «Отчет» описан ниже (в порядке следования полей на форме):

| Реквизит  | Описание |
|:---------------:| :-------------|
|Наименование	|Поле для ввода наименования отчета, которое будет идентифицировать отчет в системе.|
|Описание	|Поле для ввода более подробного текстового описания отчета.|
|Тип данных	|Поле для выбора сущности, данные которой требуется представить в отчете (корневой сущности отчета). Выбор производится из полного справочника сущностей системы.|
|Показывать в списке	Флажок, |состояние которого соответствует актуальности данного отчета.<br>Если флажок включен, отчет актуален и доступен в списке отчетов (раздел «Отчеты» на панели структуры приложения).<br>Снятие флажка означает, что данный отчет не используется и не должен быть доступен пользователям для формирования.|
|Шаблоны	|Область для работы со списком шаблонов отчета (см. п. 3.1).
|Тип вывода объектов в отчет	|Поле с выбором из выпадающего списка, позволяющее указать способ включения данных (правило отбора которых задано на вкладке «Данные») в отчет. Доступные способы описаны в п. 3.3.|

## 	Ведение списка шаблонов

Шаблон отчета в списочном отчете соответствует вложенному отчету на схеме Рис. 1.1. Шаблоном списочного отчета называется файл в формате, соответствующему формату выходной формы отчета (т.е., например, документ MS Office: Word или Excel). Этот файл должен содержать т.н. управляющие инструкции, которые определяют правила обработки данные выборки и включения их в отчет. Списочный отчет формируется путем создания документа (MS Word или Excel) на основе шаблона отчета и заменой управляющих инструкций данными, отобранными из БД системы.

Если в рамках одного списочного отчета создано несколько шаблонов, это означает, что при формировании отчета будет создано несколько файлов, соответствующих шаблонам.

Список шаблонов представляет собой таблицу, ячейки которой служат для отображения и редактирования параметров шаблона. При установке фокуса в ячейку таблицы становится виден элемент управления, с помощью которого значение ячейки и, соответственно, параметр отчета могут быть изменены.

Структура таблицы описана ниже.

| Колонка таблицы  | Описание |
|:---------------:| -------------:|
|Наименование шаблона	|Наименование файла шаблона (включая расширение файла). Клик мышью на ячейке, отображающей имя файла, включает режим редактирования имени: оно может быть изменено набором текста с клавиатуры.<br>Следует иметь в виду, что в процессе редактирования имени нельзя удалять расширение файла. Иначе формат файла не будет автоматически определен при открытии шаблона для редактирования и при формировании отчета.|
|Не обрабатывать	|Флажок, позволяющий временно исключить раздел, соответствующий данному шаблону, при формировании отчета. Данная функция имеет смысл, если отчет содержит несколько вложенных шаблонов.|
|Формат шаблона	|Поле для отображения формата шаблона, недоступно для изменения.|
|**Способ обработки**	||
|Формат документа	|Поле для выбора формата, в котором требуется представить сформированный отчет. По умолчанию результирующий формат документа тот же, что и формат шаблона отчета. Кроме этого, можно выбрать (выпадающий список в ячейке) форматы HTML и PDF. В этих случаях сформированный отчет будет преобразован в указанный формат.|
|Наименование документа	|В это поле при необходимости можно ввести имя файла (включая расширение), которое должен получить файл сформированного отчета. Если поле оставить пустым (по умолчанию), имя сформированного файла будет состоять из наименования отчета, указанного в поле «Наименование шаблона».<br>В обоих случаях при формировании отчета в имя файла включается уникальный идентификатор GUID (шестнадцатеричное число), который генерируется при каждом запуске отчета на формирование.	|

Управление списком шаблонов производится с помощью команд, описанных в таблице ниже.

| Команда  | Элемент управления формы| Описание |
|:------------- |:---------------:| :-------------|
|Показать/спрятать группы файлов	|![6](/uploads/0-gen-otch/6.png "6")||
|Импорт	|![7](/uploads/0-gen-otch/7.png "7")|Команда импортирования шаблона отчета из файла (см. п.3.1.2).|
|Экспорт |![8](/uploads/0-gen-otch/8.png "8")|Команда экспортирования шаблона отчета в файл (см. п. 3.1.1).|
|Просмотр/редактирование	|![9](/uploads/0-gen-otch/9.png "9")|Открытие шаблона для просмотра и внесения изменений. При нажатии на кнопку открывается на редактирование с помощью соответствующей программы файл шаблона отчета,выделенный в списке в момент нажатия кнопки. Программа для редактирования определяется автоматически по расширению файла шаблона. Редактирование шаблона производится средствами программы-редактора (MS Word, Excel) и включает в себя проектирование внешнего вида отчета и включения в него управляющих инструкций для вывода данных БД. Управляющие инструкции описаны в п. 5.|
|Генерация нового	||Создание нового шаблона отчета (см. п. 3.2).|

### 	Экспорт отчета

Экспорт (выгрузка) файла шаблона производится с помощью кнопки ![8](/uploads/0-gen-otch/8.png "8")	, расположенной над списком шаблонов отчета справа. При нажатии кнопки открывается стандартный диалог ОС
Windows для выбора места расположения и ввода наименования файла. После подтверждения процедуры сохранения файла и закрытия диалога файл шаблона отчета сохраняется в указанной папке, после чего может быть скопирован/перенесен, отправлен по почте и т.д.

Созданный таким образом файл шаблона отчета может быть в дальнейшем импортирован в другой инсталляции системы. Процедура импорта отчета из такого файла описана в п. 3.1.2.

### 	Импорт отчета
Импорт (загрузка) файла шаблона производится с помощью кнопки ![7](/uploads/0-gen-otch/7.png "7")	, расположенной надсписком шаблонов отчета справа. При нажатии кнопки система отображает диалог выбора формата для импортируемого шаблона отчета, показанный на рисунке ниже.

![10](/uploads/0-gen-otch/10.png "10")
После указания требуемого значения и подтверждения кнопкой <ОК> открывается стандартный диалог ОС Windows для выбора файла. Затем выбранный пользователем файл становится виден в списке шаблонов списочного отчета. Чтобы загрузить данные указанного шаблона в БД, нужно сохранить изменения в форме редактирования списочного отчета.

При импорте отчета необходимо иметь в виду, что БД приложения, в которое импортируется
шаблон, должна иметь такие же сущности и их атрибуты, которые описаны в шаблоне отчета, иначе при попытке формирования отчета возникнет ошибка.

## 	Создание шаблона списочного отчета

Для создания нового шаблона нужно нажать кнопку ![10 1](/uploads/0-gen-otch/10-1.png "10 1")	, расположенную выше списка шаблонов отчета. При нажатии на кнопку появляется диалог, аналогичный показанному на рисунке ниже.

![11](/uploads/0-gen-otch/11.png "11")

Реквизиты формы диалога описаны ниже.


| Реквизит| Описание|
|:------------- |:---------------| 
|Имя файла	|Поле для ввода имени, которое имя будет иметь файл шаблона. В приведенном на рисунке примере файл будет иметь полное имя«АПП Итоги.xls».|
|Корневая сущность отчета	|Поле с выбором значения из справочника сущностей системы. Корневая сущность – это та сущность, данные которой будут использоваться при формировании отчета.<br>Поле будет заполнено автоматически и недоступно для изменения, если сущность уже была указана ранее в поле «Тип данных» главной формы списочного отчета (см. Рис. 3.1).|
|Атрибуты, значения которых выводятся в отчет	|Список для выбора атрибутов сущности, аналогичный описанному в п. 3.4.1. Отмеченные здесь атрибуты будут включены в автоматически формируемый шаблон отчета (см. ниже).<br>Если нужные атрибуты уже были заданы на вкладке «Данные» формы редактирования списочного отчета (см. п. 3.4.1), они будут отмечены и в данном списке.|
|Формат файла	|Поле для выбора формата шаблона отчета из списка допустимых форматов| (см. п. 1.3).

Нажатие кнопки подтверждения создания отчета (<ОК>) создает файл шаблона указанного формата с указанным именем и открывает его на редактирование с помощью соответствующей программы.
В данный шаблон автоматически включаются управляющие инструкции, позволяющие вывести значения указанных атрибутов корневой сущности отчета в виде таблицы, где каждому атрибуту соответствует колонка таблицы. Пример такого автоматически созданного шаблона списочного отчета приведен на рисунке ниже.

![12](/uploads/0-gen-otch/12.png "12")

Использование управляющих инструкций подробно описано в п. 5.

В автоматически созданном шаблоне применяется форматирование по умолчанию. Для придания отчету требуемого внешнего вида нужно настроить ширину колонок, высоту строк, размер и цвет шрифта, установить параметры границ ячеек, параметры страницы и т.д., сохранить файл шаблона, а также сохранить изменения в форме настройки шаблона в приложении.


## Способы включения элементов выборки в списочный отчет

Поле для указания способа расположено в нижней части вкладки «Отчет» формы редактирования шаблона списочного отчета (см. Рис. 3.1, поле «Тип вывода объектов в отчет») и содержит
следующие варианты для выбора:
* 	Все в одном документе;
* 	Каждый в отдельном документе.

Необходимо иметь в виду, что указанный способ должен быть учтен в управляющих инструкциях шаблона. Т.е. изменение способа включения данных в отчет без внесения соответствующих
изменений в управляющие инструкции шаблона может вызвать ошибку при попытке формирования отчета.

## 	Настройка отбора данных для отчета

Выбор корневой сущности отчета производится на вкладке «Отчет» формы редактирования списочного отчета. Она определяет набор данных, на основании которого будет формироваться отчет. На вкладке «Данные» могут быть уточнены требования к этому набору данных: наложен фильтр, ограничен перечень атрибутов сущности и указано правило сортировки данных.

Если эти дополнительные условия не будут заданы, в выборку для отчета попадут все данные (объекты) корневой сущности и их сортировка будет определяться физическим порядком расположения записей в БД.
Форма редактирования списочного отчета в режиме настройки отбора данных показана на рисунке ниже.

![13](/uploads/0-gen-otch/13.png "13")

Структура вкладки «Данные» описана в таблице ниже.

| Реквизит| Описание|
|:------------- |:---------------| 
|Формирование данных	|Поле для выбора способа отбора данных при формировании отчета. В настоящее время применяется столько один способ «Выборка данных из БД», который установлен по умолчанию.|
|![401](/uploads/0-gen-otch/--401.png "401")(Сформировать XSD схему данных)||	
|![402](/uploads/0-gen-otch/--402.png "402")(Сформировать XML с данными)||	
|(Сущность)	|Поля для отображения наименования корневой сущности отчета и ее имени в СУБД. Отображаемое здесь имя сущности в СУБД может понадобиться при использовании генератора инструкций (см. п. 6).|
|Фильтр	|Вкладка для настройки фильтра для отбора данных указанной сущности.Создание фильтра производится с помощью редактора выражений, описанного в отдельном Руководстве пользователя.|
|Атрибуты	|Вкладка для выбора атрибутов сущности, значения которых должны выводиться в отчете. Работа с вкладкой описана в п. 3.4.1
|Сортировка	|Вкладка для настройки сортировки данных для отчета. Работа с вкладкой описана в п. 3.4.2.	|

### 	Выбор атрибутов сущности

Для выбора атрибутов корневой сущности, которые должны быть представлены в отчете, предназначена вкладка «Атрибуты», доступная в режиме настройки отбора данных. Вкладка содержит древовидный список атрибутов корневой сущности отчета с возможностью выбора, как это показано на рисунке ниже.

![14](/uploads/0-gen-otch/14.png "14")

Выбор атрибута производится включением флажка, расположенного рядом с наименованием атрибута. Над списком атрибутов располагаются кнопки управления списком, описанные ниже.

| Реквизит| Описание|
|:------------- |:---------------| 
|![403](/uploads/0-gen-otch/--403.png "403")(Выделить все)	|Кнопка, позволяющая включить в отчет все доступные в списке атрибуты корневой сущности (включить флажки у всех элементов списка).|
|![404](/uploads/0-gen-otch/--404.png "404")(Убрать все отметки о выделении)	|Кнопка, позволяющая снять выделение у всех элементов списка.|
|![405](/uploads/0-gen-otch/--405.png "405")(Включить/ отключить показ вычислимых атрибутов)		|Кнопка позволяет управлять отображением (скрытием) вычислимыхатрибутов. Подробнее о вычислимых атрибутах см. Руководство пользователя по редактору выражений.|

Если навести указатель мыши на атрибут при нажатой клавише [Ctrl], будет выведена подсказка с отображением имени этого атрибута в СУБД (текстовая строк на латинице, без пробелов). Имя атрибута используется при написании управляющих инструкций (см. п. 5).

Подробнее о сущностях, атрибутах и видах атрибутов см. Руководство пользователя по редактору выражений.


### 	Настройка сортировки данных

С помощью данной вкладки можно задать условие сортировки данных в выборке. Данная сортировка будет определять порядок вывода элементов выборки (объектов) при формировании отчета. Внешний вид вкладки показан на рисунке ниже.

![15](/uploads/0-gen-otch/15.png "15")

Форма настройки сортировки состоит из двух панелей. Левая содержит список атрибутов корневой сущности отчета (в алфавитном порядке), правая – список атрибутов, по которым должна
производиться сортировка. Чтобы добавить сортировку по значению атрибута, нужно выделить его в левом списке и нажать кнопку ![16](/uploads/0-gen-otch/16.png "16")	. Наименование атрибута появится в конце правого списка. Для него по умолчанию будет указана в прямом алфавитном порядке.

Управлять очередностью сортировки атрибутов можно с помощью кнопок ![17](/uploads/0-gen-otch/17.png "17")	и	![18](/uploads/0-gen-otch/18.png "18") , порядок сортировки по атрибуту можно изменить кнопками ![406](/uploads/0-gen-otch/--406.png "406")	и ![407](/uploads/0-gen-otch/--407.png "407")	. Изменение применяется к атрибуту, который в момент нажатия кнопки выделен в списке.

## Предоставление прав на отчет

# 	Создание отчета с помощью генератора
Для создания нового отчета необходимо на панели структуры приложения выбрать папку «Отчеты»->«Генератор отчетов» и в открывшемся списке отчетов добавить новый элемент с помощью кнопки панели инструментов или контекстного меню списка.

Порядок следования подразделов данного раздела руководства в целом соответствует последовательности создания отчета в системе.

## 	Создание шаблона отчета
Форма редактирования отчета открывается на вкладке рабочей области приложения и имеет вид, показанный на Рис. 4.1.

![21](/uploads/0-gen-otch/21.png "21")

Состав реквизитов формы описан ниже (в порядке следования полей на форме):


| Реквизит| Описание|
|:------------- |:---------------| 
|Наименование отчета	|Поле для ввода наименования отчета, которое будет идентифицировать отчет в системе.|
|<Просмотр>	|Кнопка для запуска формирования отчета и просмотра его данных в окне приложения.|
|<Сформировать>	|Кнопка для запуска формирования отчета в виде электронного документа,соответствующего заданному шаблону (см. раздел формы «Файлы отчета».|
|Вложенные отчеты	|Раздел формы, предназначенный для ведения списка вложенных
отчетов (ведение списка и создание вложенного отчета описано в п. 4.2).|
|Файлы отчета	|Раздел для ведения списка шаблонов печатных форм, соответствующих данному отчету. Ведение списка описано в п. 0.
|Права на отчет	|Раздел ведения списка ролей, которым предоставлено право доступа к данному отчету (см. п. 4.12).|

## 	Создание вложенного отчета
Вложенный отчет – это составной элемент отчета, для которого могут быть указаны:
* 	шаблон структуры, определяющий состав данных, структуру табличной формы и правила отбора данных;
* 	правила отбора данных (дополнительно к правилам, заданным в шаблоне структуры);
* 	правила сортировки данных.
	
Отчет должен включать как минимум один вложенный отчет. Количество вложенных отчетов не ограничивается.

Ведение списка осуществляется с помощью кнопок-ссылок «Добавить» и «Удалить». Позиция списка открывается для просмотра и редактирования двойным кликом мышью на нужной строке. Форма редактирования данных вложенного отчета показана на Рис. 4.2.

![22](/uploads/0-gen-otch/22.png "22")

Состав реквизитов формы описан ниже (в порядке следования полей на форме):

| Реквизит| Описание|
|:------------- |:---------------| 
|Отчет	|Поле ссылки на шаблон структуры вложенного отчета. Список шаблонов открывается кнопкой ![24](/uploads/0000004/24.png "24")	, в котором можно выбрать уже существующий шаблон или создать новый с помощью контекстного меню списка. Форма редактирования шаблона структуры описана в п. 0.|
|Кнопка![13](/uploads/000004/13.png "13")	|Кнопка для открытия формы редактирования шаблона структуры. Форма редактирования описана в п. 0.|
|Ссылка	|Наименование вложенного отчета, которое будет использоваться для ссылки на вложенный отчет в шаблоне печатной формы отчета. **Правила формирования**|
|Фильтр на отчет	|Вкладка для создания условия отбора данных для отчета с помощью редактора выражений (см. руководство по редактору выражений). Если для вложенного отчета уже создана и указан шаблон структуры отчета (см. п. 0.),в левой панели фильтра отображаются атрибуты сущности данных,связанной с шаблоном.|
|Сортировка	|Вкладка для настройки порядка сортировки данных отчета (см. п. 4.10).|

Следует иметь в виду, что фильтр и сортировка данных, указываемые в данной форме,применяются к данным БД до применения всех остальных условий отбора и операций работы с данными, заданных для группировщиков и групп отчета.

Если условие фильтра на данные не задано, в расчет будут взяты все данные данной сущности. При большом объеме данных формирование отчета может занять значительное время. Поэтому после создания и настройки шаблона структуры вложенного отчета следует вернуться к данному разделу формы и указать правило отбора данных или убедиться, что требуется анализ полного набора данных. Как правило, отчетные формы содержат какие-либо фильтры на данные – по периоду,
организации и т.д.

Сортировка данных также может иметь большое значение при расчете значений отчета. Если
сортировка не будет задана, данные для отчета будут отобраны в том порядке, в каком они лежат на жестком диске базы данных приложения, что может не отвечать цели формирования отчета. В частности, может потребоваться отобрать запись, последнюю по учетной дате (последнее
посещение, последнее обращение и т.д.). В этом случае для данных должна быть задана сортировка по требуемой дате.

## 	Создание шаблона структуры вложенного отчета
Шаблон структуры вложенного отчета определяет данные, которыми будет наполняться отчет, и структуру этих данных (структуру табличной формы). Форма редактирования данных шаблона
структуры показана на Рис. 4.3.

![23](/uploads/0-gen-otch/23.png "23")

Состав реквизитов формы описан в таблице (в порядке следования полей на форме):

| Реквизит| Описание|
|:------------- |:---------------| 
|**Вкладка «Основное»**	||
|Наименование	|Поле ввода наименования структуры шаблона. Это наименование отображается в списке шаблонов при создании вложенного отчета, поэтому наименование должно быть максимально информативным.|
|Тип данных	|Поле для выбора сущности, данные которой требуется представить в отчете. Выбор производится из полного справочника сущностей системы.|
|Группировщики	|Раздел для ведения списка группировщиков. Ведение списка производится с помощью кнопок-ссылок «Добавить» и «Удалить».<br>Позиция списка открывается для просмотра двойным кликом мышью на нужной строке.<br>Создание группировщика описано в п.4.4.|
|**Дополнительные функции отчета**|	
|Вкладка «Фильтр»	|См. п. 0|
|Вкладка «Дополнительно»		|См. п. 4.8|

## 	Создание группировщика
Группировщик определяет структуру заголовков табличной формы. Форма редактирования данных группировщика показана на Рис. 4.4.

![24](/uploads/0-gen-otch/24.png "24")

Состав реквизитов формы описан в таблице (в порядке следования полей на форме):

| Реквизит| Описание|
|:------------- |:---------------| 
|Генератор	|Поле для указания шаблона структуры группировщика. Список шаблонов открывается кнопкой![25](/uploads/0-gen-otch/25.png "25")	, в котором можно выбрать уже существующий шаблон или создать новый с помощью контекстного меню списка. Форма редактирования шаблона структуры группировщика описана в п. 4.5.|
|Кнопка![13](/uploads/000004/13.png "13")		|Кнопка открытия формы редактирования шаблона структуры группировщика (см. п. 4.5).|
|Путь до генератора	|Поле для выбора атрибута|
|Описание	|Текст, описывающий группировщик. Этот текст будет выводиться в списке группировщиков вложенного отчета, поэтому он должен быть максимально информативным.|
|Ссылка	|Имя группировщика, которое будет использоваться для ссылки на него в шаблоне печатной формы отчета.|

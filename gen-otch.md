<!-- TITLE: Генератор отчетов -->
<!-- SUBTITLE: Руководство пользователя системы «ВИТАКОР» -->

# Введение
Генератор отчетов представляет собой модуль,который является составной частью программных продуктов компании «Витакор». Модуль предназначен для создания форм отчетов и формирования готовых отчетов (заполнение форм данными). Генератор позволяет создавать и редактировать ранее созданные отчеты без привлечения разработчиков системы, силами подготовленного пользователя или администратора.


# Общие сведения

Отчет – документ, формируемый на основе данных, хранящихся в БД приложения. Как правило, отчет имеет форму таблицы (или нескольких таблиц), и даже если отчет имеет нетабличную выходную форму, его данные всегда могут быть представлены в виде таблицы.

На рис. показана структура отчета на примере Формы 12 «Сведения о числе заболеваний, зарегистрированных у больных…». Практически любой отчет имеет аналогичнуюструктуру.В более простом случае отчет может состоять только из одного вложенного отчета и может не иметь заголовков строк.

![1](/uploads/0-gen-otch/1.png "1")

В табличной форме данные выводятся в направлении т.н. «осей» отчета – заголовки колонок представляют собой одну ось (ось X), заголовки строк – другую ось (ось Y). Двумерный отчет содержит две оси вывода данных (обычная таблица), трехмерный – три и т.д.Т.о. каждая из «осей» отчета содержит определенный набор показателей, значения которых будут отбираться и/или вычисляться в процессе формирования отчета и выводиться в ячейках таблицы, соответствующих области данных. Наименования этих показателей выводятся в качестве заголовков столбцов (в случае оси X), строк (ось Y) таблицы.

**Способы отображения дополнительных осей отчета.**

Вышесказанное проиллюстрировано на рис. 1.2, где показан образец структуры вложенного отчета, описанный в терминах генератора отчетов.

![2](/uploads/0-gen-otch/2.png "2")

Каждой «оси» отчета соответствует т.н. «Группировщик»: сущность, описывающая структуру оси – количество показателей, порядок их следования и группировку.

Группировщик, в свою очередь, содержит составные элементы – группы, соответствующие заголовкам и подзаголовкам строк или столбцов отчета. Из схемы видно, что группы могут иметь иерархические связи между собой. Каждый группировщик связывается с определенностью сущностью БД системы и для каждой его группы указываются правила отбора данных и расчета значения.

На пересечении групп по различным осям отчета, в области данных, располагаются собственно данные отчета. Содержимое ячейки отчета на пересечении областей данных групп определяется правилами, заданными для этих групп.

Руководствуясь данным описанием структуры отчета можно выделить следующий перечень и последовательность разработки составных элементов отчета:
•	Вложенные отчеты;
•	Для каждого вложенного отчета: группировщики, их количество, расположение;
•	Для каждого группировщика: группы, их количество и отношения между ними.

Важно для всех элементов отчета подобрать информативные наименования для того, чтобы в дальнейшем, при использовании и редактировании отчета можно было легко читать его структуру

**Допустимые форматы отчета**
-	документа MS Word (.doc);
-	электронной таблицы MS Excel (.xls);
-	документа HTML;
-	текстового документа.

Для возможности создания шаблона отчета на компьютере пользователя должна быть установлена программа, соответствующая требуемому формату отчета.

# Создание отчета 
Для создания нового отчета необходимо на панели структуры приложения выбрать папку «Отчеты» - «Генератор отчетов» и в открывшемся списке отчетов добавить новый элемент с помощью кнопки панели инструментов или контекстного меню списка.

Порядок следования подразделов данного раздела руководства в целом соответствует последовательности создания отчета в системе.

## Создание шаблона отчета

Форма редактирования отчета открывается на вкладке рабочей области приложения и имеет вид, показанный на Рис.:

![3](/uploads/0-gen-otch/3.png "3")

Состав реквизитов формы описан ниже (в порядке следования полей на форме):

| Реквизит| Описание|
|:------------- |:---------------| 
|Наименование отчета	|Поле для ввода наименования отчета, которое будет идентифицировать отчет в системе.|
|<Просмотр>	|Кнопка для запуска формирования отчета и просмотра его данных в окне приложения.|
|<Сформировать>	|Кнопка для запуска формирования отчета в виде электронного документа, соответствующего заданному шаблону.|
|Вложенные отчеты	|Раздел формы, предназначенный для ведения списка вложенных отчетов.|
|Файлы отчета	|Раздел для ведения списка шаблонов печатных форм, соответствующих данному отчету. Ведение списка описано в п. 0.|
|Права на отчет	|Раздел ведения списка ролей, которым предоставлено право доступа к данному отчету.|

## Создание вложенного отчета

Вложенный отчет – это составной элемент отчета, для которого могут быть указаны:
•	шаблон структуры, определяющий состав данных, структуру табличной формы и правила отбора данных;
•	правила отбора данных (дополнительно к правилам, заданным в шаблоне структуры);
•	правила сортировки данных.

Отчет должен включать как минимум один вложенный отчет. Количество вложенных отчетов не ограничивается.
Ведение списка осуществляется с помощью кнопок-ссылок «Добавить» и «Удалить» (Рис.)

![4](/uploads/0-gen-otch/4.png "4")
 
Позиция списка открывается для просмотра и редактирования двойным кликом мышью на нужной строке. Форма редактирования данных вложенного отчета показана на рис.

![5](/uploads/0-gen-otch/5.png "5")

Состав реквизитов формы описан ниже (в порядке следования полей на форме):

| Реквизит| Описание|
|:------------- |:---------------| 
|Отчет	|Поле ссылки на шаблон структуры вложенного отчета. Список шаблонов открывается кнопкой ![6](/uploads/0-gen-otch/6.png "6") , в котором можно выбрать уже существующий шаблон или создать новый с помощью контекстного меню списка.|
|Кнопка ![7](/uploads/0-gen-otch/7.png "7") 	|Кнопка для открытия формы редактирования шаблона структуры. |
|Ссылка	|Наименование вложенного отчета, которое будет использоваться для ссылки на вложенный отчет в шаблоне печатной формы отчета.|
|Фильтр на отчет	|Вкладка для создания условия отбора данных для отчета с помощью редактора выражений. Если для вложенного отчета уже создана и указан шаблон структуры отчета, в левой панели фильтра отображаются атрибуты сущности данных, связанной с шаблоном.|
|Сортировка	|Вкладка для настройки порядка сортировки данных отчета.|

Следует иметь в виду, что фильтр и сортировка данных, указываемые в данной форме, применяются к данным БД до применения всех остальных условий отбора и операций работы с данными, заданных для группировщиков и групп отчета.

Если условие фильтра на данные не задано, в расчет будут взяты все данные данной сущности. При большом объеме данных формирование отчета может занять значительное время. Поэтому после создания и настройки шаблона структуры вложенного отчета следует вернуться к данному разделу формы и указать правило отбора данных или убедиться, что требуется анализ полного набора данных. Как правило, отчетные формы содержат какие-либо фильтры на данные – по периоду, организации и т.д.

Сортировка данных также может иметь большое значение при расчете значений отчета. Если сортировка не будет задана, данные для отчета будут отобраны в том порядке, в каком они лежат на жестком диске базы данных приложения, что может не отвечать цели формирования отчета. В частности, может потребоваться отобрать запись, последнюю по учетной дате (последнее посещение, последнее обращение и т.д.). В этом случае для данных должна быть задана сортировка по требуемой дате.

## Создание шаблона структуры вложенного отчета

Шаблон структуры вложенного отчета определяет данные, которыми будет наполняться отчет, и структуру этих данных (структуру табличной формы). Форма редактирования данных шаблона структуры показана на рис 

![8](/uploads/0-gen-otch/8.png "8")

Состав реквизитов формы описан в таблице (в порядке следования полей на форме):

| Реквизит| Описание|
|:------------- |:---------------| 
|**Вкладка «Основное»**	|
|Наименование	|Поле ввода наименования структуры шаблона. Это наименование отображается в списке шаблонов при создании вложенного отчета, поэтому наименование должно быть максимально информативным.|
|Тип данных	|Поле для выбора сущности, данные которой требуется представить в отчете. Выбор производится из полного справочника сущностей системы.|
|Группировщики	|Раздел для ведения списка группировщиков. Ведение списка производится с помощью кнопок-ссылок «Добавить» и «Удалить». Позиция списка открывается для просмотра двойным кликом мышью на нужной строке.|

##  Группировщик

Группировщик определяет структуру заголовков табличной формы. Форма редактирования данных группировщика показана на Рис.

![9](/uploads/0-gen-otch/9.png "9")

Состав реквизитов формы описан в таблице (в порядке следования полей на форме):
| Реквизит| Описание|
|:------------- |:---------------| 
|Генератор	|Поле для указания шаблона структуры группировщика.Список шаблонов открывается кнопкой ![10](/uploads/0-gen-otch/10.png "10") , в котором можно выбрать уже существующий шаблон или создать новый с помощью контекстного меню списка. |
|Кнопка ![11](/uploads/0-gen-otch/11.png "11") 	|Кнопка открытия формы редактирования шаблона структуры группировщика.
Путь до генератора	Поле для выбора атрибута| 
|Описание	|Текст, описывающий группировщик. Этот текст будет выводиться в списке группировщиков вложенного отчета, поэтому он должен быть максимально информативным.|
|Ссылка	|Имя группировщика, которое будет использоваться для ссылки на него в шаблоне печатной формы отчета.|

### Структуры группировщика

Структура группировщика соответствует заголовкам, отображаемым в оси отчета, и описывается с помощью формы редактирования, показанной на Рис 

![12](/uploads/0-gen-otch/12.png "12")     ![13](/uploads/0-gen-otch/13.png "13")

Состав реквизитов формы описан в таблице:


| Реквизит| Описание|
|:------------- |:---------------| 
|Наименование	|Наименование группировщика.|
|Сущность	|Сущность данных, на которых строится группировщик|
|Раздел ведения списка групп	|Раздел содержит элементы управления для просмотра и управления иерархическим списком групп.|
|Список групп	|Панель для отображения иерархического списка групп.|
|Кнопка ![14](/uploads/0-gen-otch/14.png "14")	|Кнопка добавления элемента списка.|
|Кнопка ![15](/uploads/0-gen-otch/15.png "15") 	|Кнопка удаления выделенного элемента списка.|
|Кнопки ![16](/uploads/0-gen-otch/16.png "16") |Кнопки управления порядком следования элементов списка. Выделенный элемент при нажатии на кнопку перемещается на одну позицию вверх/вниз.|
|Раздел редактирования группы	|Панель, содержащая форму редактирования группы. Панель становится видна при выделении элемента иерархического списка групп. |

**Создание группы**
Группа определяет один из заголовков таблицы по данной оси отчета, а также правило формирования значения, которое будет выводится в ячейках области данных группы.

Новая группа создается по нажатию кнопки ![14](/uploads/0-gen-otch/14.png "14")  раздела ведения списка групп формы. При нажатии кнопки пользователю предлагается выбор типа группы:
* 	статическая группа (в списке обозначается пиктограммой ![17](/uploads/0-gen-otch/17.png "17") );
* 	группа по атрибутам (обозначается пиктограммой ![18](/uploads/0-gen-otch/18.png "18") ).

«Статическая группа»соответствует заголовку таблицы, текст и данные которого определяются разработчиком отчета на этапе разработки отчета. От текущего состояния БД системы будут зависеть только значения области данных, соответствующие заголовку.

В отличие от статической «Группа по атрибутам»позволяет содержимое заголовков формировать также на основании данных БД. Например, в качестве заголовков колонок таблицы могут быть взяты значения какого-либо справочника.

Форма редактированиягруппы отображается в правой части формы при выделении элемента в списке и ее внешний вид зависит от типа группы.

**Статическая группа**

На рисунках ниже показан внешний вид формы редактирования статической группы.

![19](/uploads/0-gen-otch/19.png "19")   ![20](/uploads/0-gen-otch/20.png "20")

Состав формы описан в таблице:


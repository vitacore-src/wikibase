<!-- TITLE: Списочный отчет -->
<!-- SUBTITLE: Руководство пользователя системы «ВИТАКОР»-->


Списочный отчет – это отчет, который выводит списки данных по заданным критериям.
Генератор «списочных» отчетов – это самое простое средство создания отчета. Структура и внешний вид списочного отчета определяются шаблоном отчета, созданным с помощью внешней программы – например, MSOffice (.doc, .docx, .xls, xlsx). В шаблоне списочного отчета в приложении задается сущность, данные которой будут использованы при формировании отчета, правило отбора данных сущности и права доступа к отчету. Наполнение шаблона списочного отчета данными определяется управляющими инструкциями, включенными в шаблон.

# Создание списочных отчетов

Для создания нового отчета необходимо на панели структуры приложения выбрать папку «Отчеты»:

![1](/uploads/0-spis-otch/1.png "1")
 
В  открывшемся списке отчетов добавить новый элемент с помощью кнопки панели инструментов или контекстного меню списка.
 
![2](/uploads/0-spis-otch/2.png "2")

Откроется форма шаблона списочного отчета:

![3](/uploads/0-spis-otch/3.png "3")

Форма редактирования состоит из трех вкладок:
* 	«Отчет» - содержит основные данные шаблона отчета;
* 	«Данные» – предназначена для настройки фильтра отбора данных для отчета (создания выборки);
* 	«Права» - предназначена для настройки прав доступа к отчету.

**Состав реквизитов вкладки «Отчет» описан ниже (в порядке следования полей на форме):**

| Реквизит| Описание|
|:------------- |:---------------| 
|Наименование	|Поле для ввода наименования отчета, которое будет идентифицировать отчет в системе.|
|Описание	|Поле для ввода более подробного текстового описания отчета.|
|Тип данных	|Поле для выбора сущности,  данные которой требуется представить в отчете (корневой сущности отчета). Выбор производится из полного справочника сущностей системы.|
|Шаблоны	|Область для работы со списком шаблонов отчета.|

Шаблоном списочного отчета называется файл в формате, соответствующему формату выходной формы отчета (например,  документ MSOffice: Word или Excel). Этот файл должен содержать управляющие инструкции, которые определяют правила обработки данных выборки и включения их в отчет. Списочный отчет формируется путем создания документа (MS Word или Excel)на основе шаблона отчета и заменой управляющих инструкций данными, отобранными из БД системы.

Если в рамках одного списочного отчета создано несколько шаблонов, это означает, что при формировании отчета будет создано несколько файлов, соответствующих шаблонам.

Список шаблонов представляет собой таблицу, ячейки которой служат для отображения и редактирования параметров шаблона. При установке фокуса в ячейку таблицы становится виден элемент управления, с помощью которого значение ячейки и, соответственно, параметр отчета могут быть изменены.

Структура таблицы описана ниже.

| Колонка таблицы| Описание|
|:------------- |:---------------| 
|Наименование шаблона	|Наименование файла шаблона (включая расширение файла). Клик мышью на ячейке, отображающей имя файла, включает режим редактирования имени: оно может быть изменено набором текста с клавиатуры.<br>Следует иметь в виду, что в процессе редактирования имени нельзя удалять расширение файла. Иначе формат файла не будет автоматически определен при открытии шаблона для редактирования и при формировании отчета.|
|Не обрабатывать	|Флажок, позволяющий временно исключить раздел, соответствующий данному шаблону, при формировании отчета. Данная функция имеет смысл, если отчет содержит несколько вложенных шаблонов.|
|Формат шаблона	|Поле для отображения формата шаблона, недоступно для изменения.|
|Формат документа	|Поле для выбора формата, в котором требуется представить сформированный отчет. По умолчанию результирующий формат документа тот же, что и формат шаблона отчета. Кроме этого, можно выбрать (выпадающий список в ячейке) форматы HTMLи PDF. В этих случаях сформированный отчет будет преобразован в указанный формат.|
|Наименование документа	|В это поле при необходимости можно ввести имя файла (включая расширение), которое должен получить файл сформированного отчета. Если поле оставить пустым (по умолчанию), имя сформированного файла будет состоять из наименования отчета, указанного в поле «Наименование шаблона».<br>В обоих случаях при формировании отчета в имя файла включается уникальный идентификатор GUID (шестнадцатеричное число), который генерируется при каждом запуске отчета на формирование.|

Управление списком шаблонов производится с помощью команд, описанных в таблице ниже.

| Команда| Элемент управления формы|Описание|
|:------------- |:---------------| :---------------| 
|Импорт	 	|![4](/uploads/0-spis-otch/4.png "4")|Команда импортирования шаблона отчета из файла.|
|Экспорт	 	|![5](/uploads/0-spis-otch/5.png "5")|Команда экспортирования шаблона отчета в файл. |
|Просмотр/редактирование	 	|![6](/uploads/0-spis-otch/6.png "6")|Открытие шаблона для просмотра и внесения изменений. При нажатии на кнопку открывается на редактирование с помощью соответствующей программы файл шаблона отчета, выделенный в списке в момент нажатия кнопки. Программа для редактирования определяется автоматически по расширению файла шаблона. Редактирование шаблона производится средствами программы-редактора (MSWord, Excel) и включает в себя проектирование внешнего вида отчета и включения в него управляющих инструкцийдля вывода данных БД.|
|Генерация нового	 	|![7](/uploads/0-spis-otch/7.png "7")|Создание нового шаблона отчета .|

**Экспорт отчета**

Экспорт (выгрузка) файла шаблона производится с помощью кнопки ![8](/uploads/0-spis-otch/8.png "8") ,  расположенной над списком шаблонов отчета справа. При нажатии кнопки открывается стандартный диалог ОС Windows для выбора места расположения и ввода наименования файла. После подтверждения процедуры сохранения файла и закрытия диалога файл шаблона отчета сохраняется в указанной папке, после чего может быть скопирован/перенесен, отправлен по почте и т.д.

Созданный таким образом файл шаблона отчета может быть в дальнейшем импортирован в другой инсталляции системы.

**Импорт отчета**

Импорт (загрузка) файла шаблона производится с помощью кнопки ![9](/uploads/0-spis-otch/9.png "9") , расположенной над списком шаблонов отчета справа. При нажатии кнопки система отображает диалог выбора формата для импортируемого шаблона отчета, показанный на рисунке ниже.
 
 ![10](/uploads/0-spis-otch/10.png "10")
 
После указания требуемого значения и подтверждения кнопкой <ОК> открывается стандартный диалог ОС Windows для выбора файла. Затем выбранный пользователем файл становится виден в списке шаблонов списочного отчета. Чтобы загрузить данные указанного шаблона в БД, нужно сохранить изменения в форме редактирования списочного отчета.

При импорте отчета необходимо иметь в виду, что БД приложения, в которое импортируется шаблон, должна иметь такие же сущности и их атрибуты, которые описаны в шаблоне отчета, иначе при попытке формирования отчета возникнет ошибка.

**Состав реквизитов вкладки «Данные» описан ниже (в порядке следования полей на форме):**


| Реквизит| Описание|
|:------------- |:---------------| 
|Формирование данных	|Поле для выбора способа отбора данных при формировании отчета. В настоящее время применяется столько один способ «Выборка данных из БД», который установлен по умолчанию.|
|(Сущность)	|Поля для отображения наименования корневой сущности отчета и ее имени в СУБД. Отображаемое здесь имя сущности в СУБД может понадобиться при использовании генератора инструкций.|
|Фильтр	|Вкладка для настройки фильтра для отбора данных указанной сущности. |
|Атрибуты	|Вкладка для выбора атрибутов сущности, значения которых должны выводиться в отчете. |
|Сортировка	|Вкладка для настройки сортировки данных для отчета.|

**Фильтр**

Вкладка для настройки фильтра для отбора данных указанной сущности. Создание фильтра производится с помощью редактора выражений, описанного в отдельном Руководстве пользователя.
Фильтр обязателен для заполнения. В нем указывается промежуток времени и общие данные. По которым будет формироваться отчет. 

Выбор корневой сущности отчета производится на вкладке «Отчет» формы редактирования списочного отчета. Она определяет набор данных, на основании которого будет формироваться отчет. На вкладке «Данные» могут быть уточнены требования к этому набору данных: наложен фильтр, ограничен перечень атрибутов сущности и указано правило сортировки данных.

Если эти дополнительные условия не будут заданы, в выборку для отчета попадут все данные (объекты) корневой сущности и их сортировка будет определяться физическим порядком расположения записей в БД.
Форма редактирования списочного отчета в режиме настройки отбора данных показана на рисунке ниже.

![11](/uploads/0-spis-otch/11.png "11")

**Атрибуты**

Для выбора атрибутов корневой сущности, которые должны быть представлены в отчете, предназначена вкладка «Атрибуты», доступная в режиме настройки отбора данных. Вкладка содержит древовидный список атрибутов корневой сущности отчета с возможностью выбора, как это показано на рисунке ниже.

 ![12](/uploads/0-spis-otch/12.png "12")
 
Выбор атрибута производится включением флажка, расположенного рядом с наименованием атрибута. Над списком атрибутов располагаются кнопки управления списком, описанные ниже.

| Кнопка| Описание|
|:------------- |:---------------| 
|![13](/uploads/0-spis-otch/13.png "13")(Выделить все)	|Кнопка, позволяющая включить в отчет все доступные в списке атрибуты корневой сущности (включить флажки у всех элементов списка).|
|![14](/uploads/0-spis-otch/14.png "14") (Убрать все отметки о выделении)	|Кнопка, позволяющая снять выделение у всех элементов списка.|
|![15](/uploads/0-spis-otch/15.png "15") (Включить/ отключить показ вычислимых атрибутов)	|Кнопка позволяет управлять отображением (скрытием) вычислимых атрибутов. Подробнее о вычислимых атрибутах см. Руководство пользователя по редактору выражений.|

Если навести указатель мыши на атрибут при нажатой клавише [Ctrl], будет выведена подсказка с отображением имени этого атрибута в СУБД (текстовая строк на латинице, без пробелов). Имя атрибута используется при написании управляющих инструкций.

**Сортировка**

С помощью данной вкладки можно задать условие сортировки данных в выборке. Данная сортировка будет определять порядок вывода элементов выборки (объектов) при формировании отчета. Внешний вид вкладки показан на рисунке ниже.
 
 ![16](/uploads/0-spis-otch/16.png "16")
 
Форма настройки сортировки состоит из двух панелей. Левая содержит список атрибутов корневой сущности отчета (в алфавитном порядке), правая – список атрибутов, по которым должна производиться сортировка. Чтобы добавить сортировку по значению атрибута, нужно выделить его в левом списке и нажать кнопку ![17](/uploads/0-spis-otch/17.png "17") . Наименование атрибута появится в конце правого списка. Для него по умолчанию будет указана в прямом алфавитном порядке.

Управлять очередностью сортировки атрибутов можно с помощью кнопок ![18](/uploads/0-spis-otch/18.png "18")  и ![19](/uploads/0-spis-otch/19.png "19"), порядок сортировки по атрибуту можно изменить кнопками  ![20](/uploads/0-spis-otch/20.png "20") и ![21](/uploads/0-spis-otch/21.png "21") . Изменение применяется к атрибуту, который в момент нажатия кнопки выделен в списке.

**Вкладка «Права»** представляет собой список ролей, у которых есть правда генерировать и формировать данный отчет. 

По умолчанию права уже стоят у ряда ролей:

![22](/uploads/0-spis-otch/22.png "22")

Чтобы удалить строку, нужно выделить ее курсором и нажать клавишу DELETE на клавиатуре.

Чтобы добавить еще строку с ролью нужно нажать на звездочку:
 
 ![23](/uploads/0-spis-otch/23.png "23")
 
Права у каждой роли можно изменить. Есть два варианта прав: «Редактирование и формирование» и просто «Формирование». Чтоб выбрать права для роли, нужно щелкнуть на них курсором:
 
 ![24](/uploads/0-spis-otch/24.png "24")
 
После того, как все настройки сделаны, отчет нужно сохранить:
 
 ![25](/uploads/0-spis-otch/25.png "25")


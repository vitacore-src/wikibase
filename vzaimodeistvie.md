<!-- TITLE: Взаимодействие систем ОМС-Финанс и ИС Медэксперт -->
<!-- SUBTITLE: Рабочая инструкция пользователя системы «ВИТАКОР» -->

# Настройка ОФ
<a name="h3"></a>
## 	Настройка серверов обновляемых справочников ОФ

Для передачи данных  из ОФ в МЭ необходимо провести настройку сервера обновляемых справочников, для этого на главном меню приложения ОФ пользователю необходимо выбрать пункт <Администрирование>  - <Настройка сервера обновляемых справочников>, как показано на Рис.
   
![1](/uploads/000004/1.png "1")
	 
В открывшемся окне «Настройки серверов обновляемых справочников» на панели инструментов нажать кнопку   или выбрать <Новый> кликнув правой кнопкой мыши. В появившемся окне необходимо заполнить соответствующие поля: 


| Поле  | Описание|
| ------------- | ------------- |
|Наименование источника	|Заполняется в произвольной форме.|
|Адрес сервера обновления	|Ссылка на адрес сервера обновления берётся из файла «IES.Service.exe» с расширением CONFIG, который расположен в папке сервера системы МЭ по адресу «Корневая папка / IES Server / IES.Service.exe», как показано на Рис. Открыв данный файл через текстовый редактор необходимо провести поиск по слову «DictionaryUpdateService», и скопировать ссылку из строки «<add baseAddress= "http://111.222.33.4:5555/DictionaryUpdateService"  , как показано на Рис.  <br>Для проверки работоспособности адреса сервера необходимо открыть ссылку  «Адреса сервера обновления» в браузере, если отобразится ошибка «Страница недоступна», то нужно обратиться к вашему системному администратору.|
|Ключ доступа	|«Ключ доступа», создание которого [описано в п.1.4.](#h1) настоящей инструкций. Т.е. данное поле необходимо будет заполнить после того, как будет создан первый обновляемый справочник и сгенерирован ключ доступа для него.|

![2](/uploads/000004/2.png "2")

![3](/uploads/000004/3.png "3")

Пример заполнения полей данных показан на рисунке

![4](/uploads/000004/4.png "4")

<a name="h2"></a>
## 	Создание справочников

Создание, редактирование и удаление справочников происходит через папку <Настройка обновляемых справочников>, расположение которого показано на Рис.

![5](/uploads/000004/5.png "5")

Пользователю необходимо передать значения по всем срезам планирования, данные которых относятся к сущности «DICTIONARY_BASE», например:
* 	Программы ОМС;
* 	Условия оказания МП;
* 	Вида МП;
* 	Профиля МП;
* КСГ и Группы ВМП.

Затем необходимо передать данные по остальным разделам:
* 	Базовые классификатор планирования с параметрами с сущностью «PLAN_PARAMETER»;
* 	Разделы периодов с сущностью «PERIOD_SECTION»;
* 	Разделы планирования с сущностью «PLAN_SECTION».
 	
Для создания нового справочника пользователю необходимо на панели инструментов нажать на кнопку  ![1 1](/uploads/00001/1-1.jpg "1 1")  или выбрать <Новый> кликнув правой кнопки мыши. После этого откроется окно как на Рис. 

![6](/uploads/000004/6.png "6")

Описание полей Рис. перечислены в таблице ниже:

| Поле  | Описание|
| ------------- | ------------- |
|Код справочника	|Уникальный порядковый номер, который не должен иметь дубликатов.|
|Приоритет загрузки	|Числовое поле для определения приоритета.|
|Пакетная отправка	|Ограничение на количество отправляемых записей одним запросом. Чтобы указать количество записей необходимо поставить галочку и в активировавшемся поле указать количество, например  ![7](/uploads/000004/7.png "7") .|
|Описание	|Произвольное название справочника.|

На Рис. показан пример уже заполненных полей справочника для сущности «DICTIONARY_BASE»:

![8](/uploads/000004/8.png "8")


## 	Создание атрибутов справочников

После заполнения полей, во вкладке <Передаваемые атрибуты>, необходимо создать атрибуты сущности, которые будут переданы в последствии в МЭ, для этого следует нажать на кнопку <Добавить (Insert)>, как показано на Рис.

![9](/uploads/000004/9.png "9")
 
В появившемся окне, Рис., необходимо заполнить следующие поля:

![10](/uploads/000004/10.jpg "10")

1. <Наименование> - наименование должно совпадать с наименованием атрибута сущности на которую передаются данные в МЭ. Пример как посмотреть его: в МЭ - <Справочники> - <Региональные справочники> - <Планирование> - Открыть нужный справочник (например «Условия оказания МП») - Зажать CTRL и приблизить указатель мышки к нужному значению, во всплывающем желтом окне появится необходимое значение, как показано на Рис. 

![11](/uploads/000004/11.jpg "11")

Данное значение необходимо прописать в поле наименование. Стоит отметить, что наименование и количество атрибутов должны соответствовать тому, что отображается в МЭ. Например, если наименование атрибута в МЭ отображается как PlanDictionaryID, то и в поле наименование (Рис.) они должны быть под таким значением.

2. <Описание> - произвольное название атрибута справочника.

3. <Ключевой атрибут> - необходимо отметить, если у данного атрибута заполнена «Лексема». Также отметку «Ключевой атрибут» можно поставить на главном окне вкладки <Передаваемые атрибуты> путем нажатия кнопки <Ключевой атрибут (+)> либо нажатием горячей клавиши <+> на клавиатуре.

![12](/uploads/000004/12.png "12")

4. <Лексема> ![13](/uploads/000004/13.png "13")  - совокупность данных, относящихся к одному элементу сущности. После нажатия на кнопку ![13](/uploads/000004/13.png "13") , появится окно «Текущий фильтр», где необходимо выбрать соответствующие фильтры. На Рис. показан пример заполнения лексемы для атрибута «Идентификатор».

![14](/uploads/000004/14.png "14")

Пример заполненной вкладки <Передаваемые атрибуты> показан на Рис

![15](/uploads/000004/15.png "15")

<a name="h1"></a>
## 	Настройка доступа справочников

После добавления всех атрибутов во вкладке <Настройка доступа> необходимо создать новый обновляемый справочник путем нажатия на (1) <Добавить> -(2) Выбрать <Новый> кликнув правой кнопкой мыши - (3) Создать новый «Ключ доступа» нажав на ![17](/uploads/000004/17.png "17")  -Заполнить поле <Наименование организации> - Сохранить нажатием <Ok>. Пример создания показан на Рис. 

![18](/uploads/000004/18.jpg "18")

Данный «Ключ доступа» генерируется только при создании первого справочника. При создании всех последующих справочников необходимо будет всего лишь выбрать уже готовый «Ключ доступа» из списка. 

Затем в этой же вкладке указать <Индекс сущности получателя>. Данное поле является обязательным для заполнения, поскольку оно определяет в какой таблице в базе данных они будут находится:

![19](/uploads/000004/19.png "19")

Значение для данного поля берётся из МЭ - <Администрирование> - <Сущности> - Поиск нужной сущности по наименованию - Номер из колонки <Идентификатор>. Например, для сущности «Условия оказания МП» индекс сущности получателя будет «9018», как показано на Рис. 

![20](/uploads/000004/20.png "20")

После этого у пользователя существует возможность создать условия для выгрузки справочников, посредством добавления соответствующих фильтров ([См. п.7.3 «Использование фильтров» в «Руководство пользователя базовое» ](raboch-instr-bazovaya#b11)) во вкладке <Настройка доступа>.

Например, для всех справочников с сущностью «DICTIONARY_BASE» обязательно необходимо добавить фильтр <Свойство объекта. Идентификатор типа>, как показано на Рис. 

![21](/uploads/000004/21.jpg "21")

Значение для данного поля берется из ОФ - папка <Сущности> - Найти необходимую сущность - Значение из колонки <Идентификатор>. На Рис. показан пример поиска.

![22](/uploads/000004/22.png "22")

Для справочников с сущностями «PLAN_PARAMETER», «PERIOD_SECTION», «PLAN_SECTION» необязательно указывать фильтр <Свойство объекта. Идентификатор типа> во вкладке «Настройка доступа», поскольку они создаются в единственном виде.

Вышеперечисленным образом нужно создать все необходимые справочники для передачи в МЭ.

# 	Загрузка данных из ОФ в МЭ

## 	Настройка серверов обновляемых справочников МЭ

После создания всех нужных справочников в ОФ необходимо их загрузить в МЭ. Для этого сначала нужно настроить связь между ними, открываем МЭ  - <Администрирование> -<Настройка сервера обновляемых справочников>, как показано на Рис.

![23](/uploads/000004/23.png "23")

В открывшемся окне «Настройки серверов обновляемых справочников» на панели инструментов нажать кнопку ![1 1](/uploads/00001/1-1.jpg "1 1")  - в контекстном меню выбрать <Адрес сервера обновлений справочников>, или выбрать <Новый> кликнув правой кнопки мыши - в контекстном меню выбрать <Адрес сервера обновлений справочников>. В появившемся окне нужно заполнить поля: 

| Поле  | Описание|
| ------------- | ------------- |
|Наименование источника	|Заполняется в произвольной форме.|
|Адрес сервера обновления	|Ссылка на адрес сервера обновления берётся из файла «FIES.Service.exe» с расширением CONFIG, который расположен в папке сервера системы ОФ по адресу «Корневая папка / FIES Server / FIES.Service.exe», как показано на Рис. Открыв данный файл через текстовый редактор необходимо провести поиск по слову «DictionaryUpdateService», и скопировать ссылку из строки «<add baseAddress="http://111.2.3.4:55/DictionaryUpdateService" />», как показано на Рис.<br>Для проверки работоспособности адреса сервера необходимо открыть ссылку  «Адреса сервера обновления» в браузере, если отобразится ошибка «Страница недоступна», то нужно обратиться к вашему системному администратору.|
|Ключ доступа	|Копируется из ОФ, когда впервые производилась настройка адреса сервера обновления. ([См. п. 1.4. настоящей инструкций и Рис.](#h1)).|

![24](/uploads/000004/24.png "24")

![25](/uploads/000004/25.png "25")

На Рис. показан пример заполнения полей данных:

![26](/uploads/000004/26.png "26")

## 	Загрузка справочников из МЭ в ОФ

После настройки серверов обновляемых справочников в МЭ выбираем пункт <Сервис> - <Обновить справочники>, как показано на Рис. 

![27](/uploads/000004/27.png "27")

В появившемся окне, как показано на Рис. 2.6., отобразятся все те справочники, которые были созданы и настроены в ОФ ([п. 1.2. настоящей инструкции](#h2)). Пользователю необходимо нажать кнопку <Загрузить> - если эти данные ранее не были загружены, либо нажать <Обновить> - для обновления ранее загруженных данных.

![28](/uploads/000004/28.png "28")

## 	Просмотр результатов загрузка данных

Чтобы посмотреть результат загрузки данных необходимо зайти в МЭ - <Справочники> - <Региональные справочники> - <Планирование> - <Базовые классификатор планирования с параметрами> (как показано на Рис.) и посмотреть все ли записи справочников были загружены.

![29](/uploads/000004/29.png "29")


# 	Настройка МЭ

## 	Настройка записей справочников в МЭ

После загрузки данных из ОФ в МЭ необходимо заполнить записи справочников. Например, в МЭ открыть <Справочники> - <Региональные справочники> - <Планирование> - <Базовые классификатор планирования с параметрами> (как показано на Рис.)

![30](/uploads/000004/30.png "30")

В открывшемся окне необходимо зайти в каждую запись, например, «Услуги: взрослые», как показано на Рис. 

![31](/uploads/000004/31.png "31")

В основном окне записи справочника в поле «Приоритет» указать число для определения приоритета и добавить необходимые условия с использованием конструктора запросов во вкладке «Основное условие», как показано на Рис.  ([См. п.7.3 «Использование фильтров» в «Руководство пользователя базовое» ](raboch-instr-bazovaya#b11)). 

Если у записи справочника отсутствует значение в поле «Приоритет» и отсутствуют фильтры, то данная запись не будет участвовать в расчете фактических показателей. 

![32](/uploads/000004/32.png "32")

Вышеперечисленным способом требуется заполнить все записи справочников из раздела «Планирование».

![33](/uploads/000004/33.png "33")

## 	Расчет фактических показателей

Чтобы добавить необходимые условия для расчета фактических показателей нужно изменить настройки организаций в МЭ. Для этого на главном меню МЭ необходимо выбрать пункт <Настройка> - <Настройки организаций> (как показано на Рис.) - открыть вкладку <Расчет факта> (на Рис.показан пример вкладки).

![34](/uploads/000004/34.png "34")

![35](/uploads/000004/35.png "35")

Пользователю во вкладке <Расчет факта> нужно добавить необходимые ему фильтры. ([См. п.7.3 «Использование фильтров» в «Руководство пользователя базовое» ](raboch-instr-bazovaya#b11)). 

После проведения настроек организаций пользователю необходимо провести пересчет фактических показателей за период. Для этого на главном меню МЭ выбрать пункт <Действия> - <Пересчитать фактические показатели за период>, как показано на Рис.

![36](/uploads/000004/36.png "36")

Затем в появившемся окне, как на Рис. , нажать <Да>, если требуется произвести полный перерасчет фактических показателей или <Нет>, если требуется произвести частичный перерасчет фактических показателей.

![37](/uploads/000004/37.png "37")

Результаты пересчета можно посмотреть в МЭ через пункт <Сервис> - <Просмотр произвольного списка> (Рис. )

![38](/uploads/000004/38.png "38")

В открывшемся окне выбрать сущность «Ссылка на факт», как на Рис. 

![39](/uploads/000004/39.png "39")

# 	Загрузка данных их МЭ в ОФ

## 	Настройка справочника FAKT

После расчета фактических показателей необходимо их загрузить в ОФ. Для этого нужно зайти в МЭ папку <Администрирование> - <Настройка обновления справочников> - Создать новый справочник с сущностью «FAKT» (Фактически выполненные объемы), пример показан на Рис

![40](/uploads/000004/40.png "40")

Или выбрать уже существующий справочник «Фактически выполненные объемы» как показано на Рис. 

![41](/uploads/000004/41.png "41")

Затем во вкладке <Передаваемые атрибуты> необходимо создать ([См. п.1.4 данной инструкции ](#h1)) новые атрибуты, если их недостаточно или у них не совпадает наименование. Также пользователь может добавить нужные или убрать лишние атрибуты включив/отключив галочки. Крайне важно, чтобы наименование атрибутов и их количество в точности совпадали. Пример заполненных атрибутов показан на Рис. 

![42](/uploads/000004/42.png "42")

После во вкладке <Атрибуты группировки> необходимо добавить группы атрибутов нажатием  . Пример показан на Рис. 

![43](/uploads/000004/43.png "43")

Затем во вкладке <Настройки доступа> необходимо добавить новый обновляемый справочник и сгенерировать новый «Ключ доступа» как [п.1.4 ](#h1) и Рис. Данный ключ доступа необходимо прописать в ОФ - <Администрирование> - <Настройка сервера обновляемых справочников> - в поле <Ключ доступа> ([См. п.1.1 данной инструкции ](#h3)).

После добавить необходимые фильтры в созданный нами новый обновляемый справочник ([См. п.7.3 «Использование фильтров» в «Руководство пользователя базовое» ](raboch-instr-bazovaya#b11)) и указать <Индекс сущности получателя>. Пример показан на Рис. 

![44](/uploads/000004/44.png "44")

## 	Загрузка расчета фактически выполненных объемов из МЭ в ОФ
После создания справочника «Фактически выполненные объемы» в МЭ, необходимо зайти в ОФ выбрать пункт <Сервис> - <Обновить справочники>, как показано на Рис. 

![45](/uploads/000004/45.png "45")

В появившемся окне, как показано на Рис., нажать кнопку <Загрузить> - если эти данные ранее не были загружены, или нажать <Обновить> - для обновления ранее загруженных данных.

![46](/uploads/000004/46.png "46")

## 	Просмотр результатов загрузка данных

Чтобы посмотреть результаты загруженных данных необходимо в ОФ выбрать  «Сервис» - «Просмотр произвольного списка», как показано на Рис. 

![47](/uploads/000004/47.png "47")

В открывшимся окне в поле <Сущность> выбрать «FACT_ITEM» (Запись о выполнении плана), как показано на Рис. 

![48](/uploads/000004/48.png "48")

Затем нажать «Ok».

![49](/uploads/000004/49.png "49")

После в открывшимся окне пользователю остается проверить результаты.

![50](/uploads/000004/50.png "50")

Таким образом, происходит взаимодействие двух систем ОФ и МЭ для выгрузки фактически выполненных объемов. Эти данные могут быть использованы при формировании отчетных форм, выходных данных, а также для сопоставления плановых и фактически выполненных объемов, что позволяет осуществлять мониторинг и анализ исполнения территориальной программы обязательного медицинского страхования и исполнения заданий медицинскими организациями (объемов медицинской помощи и объемов финансового обеспечения).


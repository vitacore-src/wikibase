<!-- TITLE: Руководство пользователя -->
<!-- SUBTITLE: Полное руководство пользователя -->

# Запуск и вход в программу
Запустить программу можно двойным щелчком на ярлыке программы с рабочего стола

![Images 001](/uploads/login/images-001.png "Images 001")

Также можно запустить из проводника C:\Vitacard\AIS LPU Client\Update\ AKUZ.UpdateUtility.exe

Ввести в появившемся окне имя пользователя и пароль.

![Images 002](/uploads/login/images-002.png "Images 002")


# Элементы пользовательского интерфейса
## Расположение и внешний вид

Обычно стандартный справочник располагается в окне приложения под элементом управления «Фильтр».

Фильтр является неотъемлемой частью справочника. Именно в фильтре и задается то, что должно присутствовать в справочнике. Однако если фильтр не применен, то при первоначальном открытии справочника заданной сущности (например, амбулаторные карты), справочник будет содержать все объекты этой сущности.
На рисунке показаны основные элементы стандартного справочника.

![Images 037](/uploads/44/images-037.png "Images 037")

Бегунок в правой части показывает положение текущего элемента в списке. Если в списке не умещаются все элементы, то имеется возможность пролистывания списка. В этом случае, бегунок следует протягивать вверх или вниз для «пролистывания» списка. Размер бегунка зависит от количества, присутствующих в базе данных записей. Чем записей больше, тем меньше размер бегунка.

В левом нижнем углу окна приложения (в строке состояния) указывается, сколько всего (с учетом наложенного фильтра) записей содержится в базе данных и сколько из них выделено.

Выделение в списке одной записи осуществляется одиночным щелчком мыши на записи. Выделение нескольких записей (множественное выделение) производится следующим образом:

- нажимаем и удерживаем клавишу Control;
- щелкаем один раз на первой записи в группе, которую хотим выделить;
- щелкаем один раз на последней записи в этой группе;
- отпускаем клавишу Control.

Стоит заметить, что некоторые списки не позволяют производить множественное выделение.

Список может иметь форму предварительного просмотра выделенного элемента в нижней части списка.

## Заголовок

Список стандартного справочника имеет настраиваемый заголовок. В заголовке формируются условия отображения объектов по колонкам: количество, вид, видимость колонок, порядок их следования.

![Images 038](/uploads/44/images-038.png "Images 038")

## Контекстное меню

Некоторые элементы стандартного справочника имеют контекстное меню. Оно вызывается щелчком правой кнопки мыши на элементе и имеет вид, соответствующий набору команд, которые определены для этого элемента.

![Images 039](/uploads/44/images-039.png "Images 039")

![Images 040](/uploads/part-2/images-040.png "Images 040")

## Панель инструментов

Несмотря на то, что панель инструментов и не является непосредственно частью стандартного справочника, его поведение зависит от того, какая кнопка на панели инструментов была нажата.

Поэтому мы здесь рассмотрим панель инструментов и назначение ее кнопок, имеющих непосредственное отношение к стандартному справочнику.

![Images 041](/uploads/part-2/images-041.png "Images 041")

![Images 042](/uploads/part-2/images-042.png "Images 042") Обновить - Принудительное обновление содержимого списка.

![Images 043](/uploads/part-2/images-043.png "Images 043") Новый - Открывается форма ввода нового объекта. (При его сохранении список обновляется.)

![Images 044](/uploads/part-2/images-044.png "Images 044") Удалить - Пользователю выводится предупреждение "Вы действительно хотите удалить выделенные объекты?". Если пользователь подтверждает удаление, то объекты удаляются и текущий кадр списка обновляется. При удалении объекта, все, вложенные в него, объекты тоже удаляются.

![Images 045](/uploads/part-2/images-045.png "Images 045") Свойства объекта - Открывается форма выделенного объекта

![Images 046](/uploads/part-2/images-046.png "Images 046") Экспортировать объекты списка - Экспорт объекта списка в отдельный документ (MSExcel, MSWord, HTML, Rect, Текст)

# Работа со стандартным справочником
## Настройка колонок

Настройка колонок позволяет задавать атрибуты, которые необходимо отобразить в стандартном списке.

Имеется возможность выбрать атрибуты, их порядок, название и ширину соответствующих колонок. По команде «Выбрать атрибуты» контекстного меню заголовка колонок открывается диалоговое окно

![Images 047](/uploads/part-2/images-047.png "Images 047")

В нем можно выбрать отображаемые атрибуты перемещением при помощи стрелок из левого окна в правое. А также задать порядок размещения колонок слева-направо в списке (стрелки вверх и вниз). Для
вычислимых атрибутов (они подсвечены синим цветом) можно задать формулу, по которой они будут вычисляться при помощи кнопки ![Images 048](/uploads/part-2/images-048.png "Images 048")

Галочки на именах колонок в контекстном меню заголовка позволяют быстро скрыть/отобразить колонки с выбранными атрибутами.

Настройки колонок автоматически сохраняются для конкретного пользователя, и при следующем открытии списка восстанавливаются настройки, которые были заданы именно этим пользователем.

Сортировка при открытии списка автоматически производится по первой колонке.

## Действия над объектами

Существует три основных действия, совершаемых над объектом в стандартном справочнике:

- Добавление нового объекта;
- Редактирование существующего объекта;
- Удаление объекта.

При любом из этих действий, происходит автоматическое обновление списка. Однако, обновление можно произвести принудительно, командой «Обновить» из контекстного меню.

#### Добавление объекта.

Производится командой «Новый» контекстного меню списка или панели инструментов. При этом открывается незаполненная форма ввода характеристик нового объекта.

#### Удаление объекта.

Производится командой «Удалить» контекстного меню списка или панели инструментов. Удаляется объект, на котором находится фокус, а также выделенный объект (или выделенная группа объектов).

#### Редактирование объекта.

Объекты можно открыть для просмотра (редактирования) двойным щелчком левой кнопкой мыши на объекте или командой «Открыть» контекстного меню. Откроется форма с заполненными характеристиками объекта.

## Сортировка

При необходимости можно задать сортировку – для этого достаточно кликнуть по названию колонки, причем сортировка может производиться как по возрастанию, так и по убыванию.

![Images 049](/uploads/part-2/images-049.png "Images 049")

Первоначально, список отсортирован по первой колонке. Если щелкнуть левой кнопкой мыши по названию любой колонки в заголовке, то произойдет сортировка списка по этой колонке в порядке возрастания значения, а рядом с названием колонки появится стрелочка, указывающая порядок сортировки.

Повторный щелчок приведет к изменению порядка сортировки (в порядке убывания).

Стандартный справочник допускает сортировку по нескольким колонкам. Это означает, что можно задать не только направление сортировки в пределах одной колонки, но и порядок проведения сортировки в списке с выбором, участвующих в сортировке, колонок с назначенным, каждой из них, приоритетом.

![Images 050](/uploads/part-2/images-050.png "Images 050")

Порядок сортировки задается щелчком левой кнопкой мыши по названию любой колонки в заголовке, удерживая при этом клавишу Control.

На рисунке показан пример такой сортировки. Здесь мы видим, что сначала список сортируется по первой колонке («Фамилия») в порядке возрастания значения, затем – по второй (в порядке убывания). После чего отсортированный список еще раз сортируется по четвертой колонке («Пол») в порядке возрастания, а третья колонка вообще в задании сортировки не участвует.

## Перетаскивание объекта

Объекты из списка стандартного справочника допускают перетаскивание. Например, в приложении допускается заполнение вкладки «Избранное» объектами стандартного справочника путем перетаскивания.

![Images 051](/uploads/part-2/images-051.png "Images 051")


## Быстрый поиск

Если необходим быстрый поиск по сортируемой колонке, то достаточно набрать на клавиатуре значение данного атрибута. При этом в списке будет найден и выделен элемент, имеющий данное значение атрибута.

Причем поиск может производиться по любому атрибуту, присутствующему в справочнике: дате, фамилии, идентификатору и.т.д.

Возможно также ввести только начальную часть искомого значения, при этом будут найден первый элемент, значение атрибута которого начинается с набранной строки. Ниже приведен пример быстрого поиска
по фамилии клиента:

![Images 052](/uploads/part-2/images-052.png "Images 052")

## Обновление списка

Для обновления данных в списке следует нажать кнопку ![Images 053](/uploads/part-2/images-053.png "Images 053") на панели инструментов приложения, в которое встроен стандартный справочник, либо выбрать пункт «Обновить» в контекстном меню справочника.

# Элементы графического представления фильтров

В стандартном справочнике конструктор запросов или элемент управления фильтр располагается над списком справочника. Фильтр обведен красной линией.

![Images 054](/uploads/part-2/images-054.png "Images 054")

![Images 055](/uploads/part-2/images-055.png "Images 055")

Фильтр имеет следующие панели:

- Панель команд, объединенная с заголовком фильтра. В заголовок выводится выражение для фильтра в текстовом формате. Заголовок фильтра ![Images 056](/uploads/part-2/images-056.png "Images 056") одновременно является командной кнопкой «Свернуть / развернуть» панели фильтров. 

![Images 057](/uploads/part-2/images-057.png "Images 057")

- Панель атрибутов, представленная закладкой с именем той сущности, к которой применен фильтр 
- Панель инструментов, на которой графически представлены основные компоненты элементов конструирования фильтров
- Рабочая панель, на которой конструируются условия для фильтров в графическом представлении

Рассмотрим назначение и основные функции каждой из этих панелей.

- ![Images 058](/uploads/part-2/images-058.png "Images 058") Свернуть / развернуть фильтр -  Скрывает, открывает панели фильтра: Панель команд, Панель атрибутов, Панель инструментов, Рабочая панель

- ![Images 059](/uploads/part-2/images-059.png "Images 059") Выполняет выборку элементов, удовлетворяющих условиям фильтра

- ![Images 060](/uploads/part-2/images-060.png "Images 060") Очищает рабочую панель – отменяет условия отбора данных

- ![Images 061](/uploads/part-2/images-061.png "Images 061") Загрузить сохраненные настройки – Загружает фильтр, сохраненный ранее с помощью кнопки ![Images 062](/uploads/part-2/images-062.png "Images 062") «Сохранить настройки»

- ![Images 063](/uploads/part-2/images-063.png "Images 063") Сохранить настройки - Сохраняет фильтр, для загрузки с помощью кнопки ![Images 064](/uploads/part-2/images-064.png "Images 064") «Загрузить сохраненные настройки»

- ![Images 065](/uploads/part-2/images-065.png "Images 065") Спрятать - Скрывает панели фильтра

- ![Images 066](/uploads/part-2/images-066.png "Images 066") Редактировать в графическом виде - Переключение представления фильтра в графический вид. Автоматически отжимается кнопка "Редактировать в виде XML"

- ![Images 067](/uploads/part-2/images-067.png "Images 067")  Редактировать в виде XML - Преобразование представления фильтра в XML-формат. Автоматически отжимается кнопка "Редактировать в графическом виде". Кнопки "Отменить", Вернуть", "Отображать ошибки" становятся неактивными.
 
 - ![Images 068](/uploads/part-2/images-068.png "Images 068") Отменить - Отменяет последнее изменение фильтра (Undo)
 
 - ![Images 069](/uploads/part-2/images-069.png "Images 069") Вернуть - Возвращает последнее изменение фильтра (Redo)
 
 - ![Images 078](/uploads/part-3/images-078.png "Images 078") Отображать ошибки - Некорректные условия или части условий обводятся красным прямоугольником
 
 ## Панель атрибутов
 
Панель атрибутов располагается в левой части фильтра под панелью команд и предназначена для отображения атрибутов (полей и методов) сущности, объекты которой отображаются в списке. Размер
панели атрибутов можно изменить, переместив мышью границу его правой или нижней внешних рамок.

![Images 070](/uploads/part-2/images-070.png "Images 070")

Список атрибутов на панели имеет древовидную структуру. Простые атрибуты обозначаются в списке атрибутов иконкой ![Images 071](/uploads/part-2/images-071.png "Images 071") . Это такие атрибуты, которые не имеют ссылок на другие атрибуты. Они не могут быть развернуты в следующий уровень дерева списка. Примером простого атрибута для сущности «Приходные накладные» может служить «Дата накладной», «Номер накладной» и т.д.

Атрибуты,являющиеся так называемой «связанной сущностью», обозначаются в списке атрибутов иконкой ![Images 072](/uploads/part-2/images-072.png "Images 072") . Такие атрибуты имеют свои собственные списки атрибутов. 

Примером такого атрибута для сущности «Приходные накладные» может служить атрибут «Поставщик». Щелчком на значке ![Images 073](/uploads/part-2/images-073.png "Images 073") с помощью левой кнопки мыши можно развернуть список этих атрибутов.

В списке атрибутов сущности могут содержаться так называемые «дочерние коллекции». Дочерние коллекции обозначаются иконкой ![Images 074](/uploads/part-2/images-074.png "Images 074") . Списки их атрибутов также могут быть развернуты щелчком на значке ![Images 075](/uploads/part-2/images-075.png "Images 075") с помощью левой клавиши мыши. Примером дочерней коллекции для сущности «Приходные накладные» может служить «Записи в приходной накладной».

Как уже было сказано, атрибуты связанных сущностей и дочерних коллекций могут быть развернуты, если щелкнуть на значке ![Images 076](/uploads/part-2/images-076.png "Images 076") с помощью левой клавиши мыши в списке атрибутов, или свернуты, если щелкнуть на значке ![Images 077](/uploads/part-3/images-077.png "Images 077").


Атрибуты можно «перетаскивать» с помощью мыши на рабочую панель. Для этого необходимо навести указатель мыши на атрибут, нажать левую кнопку мыши и, не отпуская кнопки мыши, переместить указатель мыши на рабочую панель и затем отпустить кнопку. Когда мы отпустим кнопку мыши, появится форма для ввода дополнительных условий.

Если при помощи мыши «перетащить» атрибут на рабочую панель, то на рабочей панели в графическом виде появится условие, наложенное на этот атрибут.

## Панель инструментов фильтров

Панель инструментов содержит различные компоненты, в дальнейшем просто инструменты, позволяющие формировать различные условия фильтров.

Они являются запросами, параметрами запросов, системными параметрами, строковыми, логическими и арифметическими операторами.

![Images 079](/uploads/part-3/images-079.png "Images 079")

Инструменты «панели инструментов»:

- ![Images 080](/uploads/part-3/images-080.png "Images 080") Константа - Для задания значения и типа константы
- ![Images 081](/uploads/part-3/images-081.png "Images 081") Параметр «Текст» - Для задания имени строкового параметра
- ![Images 082](/uploads/part-3/images-082.png "Images 082") Параметр «Число» - Для задания имени числового параметра
- ![Images 083](/uploads/part-3/images-083.png "Images 083") Параметр «Дата» - Для задания имени параметра типа «Дата»
- ![Images 084](/uploads/part-3/images-084.png "Images 084") Параметр «Да / нет» - Для задания имени логического параметра
- ![Images 086](/uploads/part-3/images-086.png "Images 086") Параметр «Объект» - Для задания имени параметра типа «Объект»
- ![Images 087](/uploads/part-3/images-087.png "Images 087") Выбрать - Условие «Выбрать из ...» - «Выберите имя сущности»
- ![Images 088](/uploads/part-3/images-088.png "Images 088") Существует - Условие «если существует» - «Выберите имя сущности»
- ![Images 085](/uploads/part-3/images-085.png "Images 085") Поиск по дереву - Условие «если» - «Существуют предки / потомки текущей сущности»
- ![Images 089](/uploads/part-3/images-089.png "Images 089") Логическое условие «ИЛИ»
- ![Images 090](/uploads/part-3/images-090.png "Images 090") Логическое условие «И»
- ![Images 091](/uploads/part-3/images-091.png "Images 091") Круглая скобка - Скобки для объединения условий внутри выражения
- ![Images 092](/uploads/part-3/images-092.png "Images 092") Похоже - Операция сравнения по подобию
- ![Images 093](/uploads/part-3/images-093.png "Images 093") Операция «Сложение»
- ![Images 094](/uploads/part-3/images-094.png "Images 094") Операция «Вычитание»
- ![Images 095](/uploads/part-3/images-095.png "Images 095") Операция «Умножение»
- ![Images 096](/uploads/part-3/images-096.png "Images 096") Операция «Деление»
- ![Images 097](/uploads/part-3/images-097.png "Images 097") Операция «Равно»
- ![Images 098](/uploads/part-3/images-098.png "Images 098") Операция «Не равно»
- ![Images 099](/uploads/part-3/images-099.png "Images 099") Операция сравнения «Меньше или равно»
- ![Images 101](/uploads/part-3/images-101.png "Images 101") Операция сравнения «Больше или равно»
- ![Images 102](/uploads/part-3/images-102.png "Images 102") Операция сравнения «Меньше»
- ![Images 103](/uploads/part-3/images-103.png "Images 103") Операция сравнения «Больше»
- ![Images 104](/uploads/part-3/images-104.png "Images 104") Системный параметр - Для ввода зарегистрированного системного параметра, например текущий пользователь, текущая дата.

Эти инструменты помогают формировать условия фильтров, если перетащить их при помощи мыши с панели инструментов на рабочую панель,
в соответствующую часть условия.

## Рабочая панель

Рабочая панель находится справа от панели инструментов и предназначена для отображения в графическом виде конструируемого фильтра.

Перед началом конструирования, рабочая панель пуста и не содержит никаких элементов. В процессе конструирования фильтров рабочая панель заполняется условиями фильтров и содержит эти условия в
графическом представлении.

![Images 100](/uploads/part-3/images-100.png "Images 100")

Можно изменять размер окна, переместив мышью границы его левой или нижней внешних рамок.

## Использование шаблонов для текстовых выражений

При работе со строчными (текстовыми) атрибутами можно использовать шаблоны, которые значительно упрощают отбор данных, когда точное соответствие искомой строки неизвестно. 

Шаблон обозначается знаком «%». Шаблоны применяются с условием Like (подобно). Шаблон «%» может быть проставлен в конце строчного выражения, тогда отбираться будут записи с произвольным набором символов в
конце строки. Шаблон «%» может быть проставлен в начале строчного выражения, тогда отбираться будут записи с произвольным набором символов в начале строки.

И, наконец, шаблон «%» может обрамлять с двух сторон строчное выражение, и тогда в отбор попадут записи, содержащее заданное строчное выражение внутри строки.

На рисунке показан результат применения фильтра с шаблоном вначале атрибута «Фамилия». Мы применили фильтр к атрибуту «Фамилия» сущности «Сотрудники». Условие Like задано в виде «%елова». 

Графическое изображение фильтра: ![Images 105](/uploads/part-3/images-105.png "Images 105"), заголовок фильтра: ![Images 106](/uploads/part-3/images-106.png "Images 106"). 

В связанном списке будут отобраны записи с фамилиями сотрудников «Горелова», «Белова» и т.п. Фактически, в отбор попадают любые записи о сотрудниках, у которых фамилия заканчивается на «елова».

![Images 107](/uploads/part-3/images-107.png "Images 107")

# Формирование отчета
![Images 108](/uploads/part-3/images-108.png "Images 108")

## Основные понятия и термины

**Шаблон отчетного документа** (шаблон) – документ, содержащий управляющие инструкции, используемые генератором отчетов, для вывода данных бизнес объектов в отчеты.

**Управляющая инструкция** – строка, определенного формата, или xml элемент, помещаемые в тело шаблона для управления процессом формирования отчетного документа. Например, вывод атрибута объекта в
месте где расположена управляющая инструкция; организация цикла по коллекии объектов (многократный, по числу элементов в коллекции, вывод в отчетный документ фрагмента шаблона, заключенного между
определенными управляющими инструкциями).

**Сущность** (тип данных) – набор основных характеристих, одинаковых для каждого объекта из множества объектов, который позволяет эти объекты классифицировать как множество объектов определенного типа. Например, каждый клиент является одним из множества клиентов, т.е. однотипных объектов. И это множество объектов называется типом, у которого есть собирательное имя – «Клиент». Если мы говорим не обо всем множестве (типе), а только об одном его объекте, как об обобщающем представителе этого множества, не конкретизируя его, то мы пользуемся термином «сущность».

В поле «Наименование» указывается наименование отчета, поле является обязательным. В поле «Описание» - краткое описание отчета.
В поле «Тип данных» выбирается тип данных из списка существующих в базе данных.

Например, каждый клиент является одним из множества клиентов, т.е. однотипных объектов. И это множество объектов называется типом, у которого есть собирательное имя – «Клиент». Это поле является обязательным в том
случае, если тип формирования данных – выборка данных (см. Закладка «Данные»).

Флажок активности отчета доступен только администратору, по умолчанию установлен. Он включает видимость отчета для пользователей системы, независимо от настроек доступа котчета на закладке “Права”.

В списке “Шаблоны” отображаются объекты типа ReportFile, которые являются представлением шаблонов выходных документов в базе данных, то есть файлов с управляющими инструкциями. В списке
может быть указано несколько шаблонов. 

Шаблон в системе – это объект с данными:

- Наименование выходного файла;
- Формат;
- Флаг “Не обрабатывать”, по умолчанию выключен.

Наименование используется для имени, формируемого по шаблону, выходного файла.

Формат используется для задания типа выходного файла, выбирается из списка поддерживаемых форматов:

- CrystalReports;
- MS Excel;
- MS Word;
- Text;
- Rect;
- HTML.

По умолчанию не выбрано ни одно из значений.

Флаг “Не обрабатывать” используется для файлов, которые не обрабатываются в процессе формирования отчета, а предоставляются пользователю как есть.

Шаблоны, отображаемые в списке, всегда объединены в группу. В рамках отчета можно поддерживать несколько групп файлов. 

Отображение групп файлов на закладке включается/выключается кнопкой “Показать/Спрятать группы файлов”

![Images 109](/uploads/part-3/images-109.png "Images 109")

Если в отчете одна группа файлов, то отображение их списка в форме по умолчанию отключается. Если же в отчете больше чем одна группа файлов, то при открытии формы виден их список.

Группы используются, когда один набор данных (результат одного запроса к базе данных) необходимо выводить в разные наборы документов для различного использования. Поле “Наименование” используется
для ввода наименований для групп. При формировании отчета используется только одна группа файлов.

Выбор производится по флагу “По умолчанию”, но если формирование запускается из формы отчета, то используется текущая группа в списке.

Таким образом, для отчета можно задать несколько групп по несколько файлов шаблонов, по каждому из которых будет сгенерирован выходной документ. В зависимости от потребностей можно активировать
генерацию той или иной группы файлов. 

Каждый отчет в системе представляет, по сути, группу различного формата выходных форм связанных одинаковым набором параметров объекта отчет (тип бизнес-объекта, фильтр, сортировка, права на отчет).

Над списком файлов шаблонов размещена панель инструментов с кнопками, позволяющими оперировать этими файлами.

Назначение кнопок списка “Шаблоны”:

- ![Images 111](/uploads/part-3/images-111.png "Images 111") Импорт - Импортирует файл из файловой системы в отчет
- ![Images 112](/uploads/part-3/images-112.png "Images 112") Экспорт - Экспортирует выбранный файл из отчета в файловую систему
- ![Images 113](/uploads/part-3/images-113.png "Images 113") Просмотр/Редактирование - Открывает файл в ассоциированном приложении
- ![Images 114](/uploads/part-3/images-114.png "Images 114") Создать новый - Показывает форму настройки параметров для нового файла

Добавление новых записей производится выделением записи со значком ![Images 110](/uploads/part-3/images-110.png "Images 110"), следующей за последней.

Удаление записи в списке производиться вызовом команды контекстного меню “Удалить строку”, которое появляется при клике правой клавишей мыши на функциональном левом столбце списка.

В поле «вид» выбирается вид отчета:

- Все в одном документе(используется по умолчанию);
- Каждый в отдельном документе.

Вид –“каждый в отдельном документе” означает, что отчет может использоваться как печатная форма для объекта данных. Подразумевается, что отчет используется для формирования информации о
единственном объекте данных (в отличие, например, от табличных отчетов, где в одном отчете может быть выведена информация о нескольких объектах – в виде таблицы).

Надстройка поддерживает вставку в документ следующих инструкций генератору отчетов:

- Атрибут объекта ({...})
- Цикл по коллекции (#xsl:for-each)
- Группировка коллекция (#xsl:group-by)
- Заголовок цикла (#xsl:once)
- Нижний заголовок цикла (#xsl:footer)
- Условная управляющая инструкция (#xsl:if)
- Вычислимые поля ({#...})

По заполнении всех, необходимых для формирования управляющей инструкции, данных и выборе “Ok” в диалоге мастера, в активную позицию (там где находился курсор) документа
вставляется управляющая инструкция определенного типа с заданными параметрами.

В зависимости от выбранного типа управляющей инструкции, Мастер предлагает тот или иной сценарий формирования управляющей инструкции. Соответственно, вид мастера для различных
типов управляющих инструкций будет различаться. Ниже приведены типы инструкций, которые могут быть сформированы при помощи Мастера.

### Атрибут объекта ({...}).

На первом шаге выбирается сущность данных, атрибут которой выводится в отчет. На втором шаге мастер отображает список атрибутов сущности, в котором пользователь выбирает требуемый атрибут. В итоге
в документ вставляется инструкция, выводящая значение атрибута сущности.

### Цикл по коллекции (#xsl:for-each).

Инструкция предназначена для организации цикла по коллекции объектов. Инструкция задается командами: #xsl:for-each – начало тела цикла и #xsl:end – конец тела цикла. Фрагмент документа,
заключенный между ними повторяется в выходном документе столько раз, сколько объектов, удовлетворяющих параметрам управляющей инструкции, содержится в коллекции. 

Инструкция поддерживает три параметра: "Путь к коллекции" (обязательный), "Фильтр на коллекцию" и  "Сортировка коллекции”.

“Путь к коллекции” выбирается на первой закладке. Если управляющая инструкция выводит текущую для выбранного места в документе коллекцию, то на первой закладке ничего выбирать не нужно.

### Группировка коллекции (#xsl:group-by).

Инструкция группирует объекты по значениям заданного набора атрибутов. 

Группировка объектов задается командами: #xsl:group-by – начало тела группировки и #xsl:end – конец группировки. Для инструкции задаются те же параметры, что и для #xsl:for-each(Цикл по коллекции), но добавляется коллекция атрибутов группировки. 

Надстройка добавляет необходимое количество циклических управляющих инструкций (#xsl:for-each ... #xsl:end) внутрь группирующей инструкции по числу атрибутов
группировки, как того требует формат использования группирующей инструкции: в инструкцию необходимо вложить несколько пар #xsl:for-each ... #xsl:end. Их количество на единицу больше числа атрибутов
группировки. Первая вложенная пара образует цикл по группам, образованным значениями первого атрибута группировки, вторая – второго атрибута и т.д. 

Если количество атрибутов сортировки – n, то n+1 вложенная пара #xsl:for-each ... #xsl:end ограничивает тело цикла по бизнес объектам, сгруппированным по значениям атрибутов группировки.

### Заголовок цикла (#xsl:once).

Инструкция #xsl:once определяет часть тела цикла, которая должна быть выведена в отчет единожды (например, заголовок таблицы). Может быть использована только внутри пары #xsl:for-each ... #xsl:end.

Начало и конец неповторяемого блока определяются инструкциями #xsl:once ... #xsl:end.

### Нижний заголовок цикла (#xsl:footer).

Инструкция #xsl:footer определяет часть тела цикла, которая должна быть выведена в отчет единожды (например, нижний заголовок таблицы). Может быть использована только внутри пары #xsl:for-each ... #xsl:end. Начало и конец определяются инструкциями #xsl:footer ... #xsl:end.

### Условная управляющая инструкция (#xsl:if)

Инструкция задает часть шаблона, которая выводится в документ при выполнении заданного условия.

### Вычисляемые поля ({#...}).

Генератор отчетов поддерживает набор вычисляемых значений: порядковый номер в коллекции, сумма атрибута по коллекции и т.п. 

Для представления вычисляемых значений в шаблонах используется Path, состоящий из единственного строкового элемента (StepString), имя которого начинается с символа “#”. Поддерживается форматирование так же как для Path.

Работа мастера сводится к предоставлению выбора одной из вычисляемых инструкций и настройке их параметров при необходимости. Большинство инструкций вставляются в документ сразу после выбора одной из них, но инструкции #OrderNum#(число, число), #Sum() и #Count() требуют дополнительной настройки параметров, поэтому для них кнопка “Ок” не доступна, а доступна кнопка “Далее”.

### #OrderNum#(число, число)

Уровень вложенности... – числовой параметр, используется для указания глубины вложенности инструкции в старший цикл. Выводит порядковый номер итерации в старшем цикле. 

Нулевым считается цикл, в который вложена инструкция. То есть использование %%#OrderNum#%% идентично использованию – %%#OrderNum#(0)%%.

Сквозная нумерация... – переключатель, используется для вывода сквозной нумерации объектов.

Признак объекта – (notIList), поэтому инструкцию с двумя параметрами удобно использовать в группировках, где элементами в циклах являются группы объектов (IList), и только в младшем цикле элементом является
объект (notIList). Второй параметр в этом случае включает вывод сквозной нумерации объектов несмотря на группы в которую каждый из них попал. Перый параметр в этом случае определяет цикл (по группам, образованным значениями заданного атрибута), сквозная нумерация объектов для которого выводится, то есть все объекты выводимые этим циклом будут иметь сквозную нумерацию.

### #Sum()

Инструкция суммирует значение атрибута для коллекции обектов. Мастер позволяет задать параметры инструкции: “Путь к коллекции”, “Суммируемый атрибут”, “Фильтр на коллекцию”.

“Путь к коллекции”– не обязательный, задает путь к коллекции объектов значение атрибута которых суммируется. Если ничего не выделено, то в качестве коллекции используется коллекция объектов родительской управляющей инструкции, той внутрь которой помещена сумма.

“Суммируемый атрибут” – обязательный, определяет суммируемый атрибут, который должен быть числовым, если ничего не выделено, то используется текущая коллекция.

“Фильтр на коллекцию” – используется для фильтрации объектов, атрибут которых суммируется.

### #Count()

Инструкция выводит количество элементов в коллекции. Мастер позволяет задать параметры инструкции: “Путь к коллекции”, “Фильтр на коллекцию”.

“Путь к коллекции” – не обязательный, если ничего не выбрано, то в качестве коллекции используется коллекция объектов родительской управляющей инструкции, той внутрь которой помещена инструкция.

“Фильтр на коллекцию” – не обязательный, используется для определения фильтра на объекты коллекции число которых подсчитывается.

Кнопка «Сформировать» запускает процедуру формирования отчета.

## Генерация нового шаблона

На панели инструментов списка “Шаблоны”, имеется кнопка ![Images 115](/uploads/part-3/images-115.png "Images 115") “Создать новый”. При клике на нее мышкой запускается процесс формирования нового шаблона для отчета. 

Открывается форма настройки параметров нового шаблона, в которой задаются:

- наименование для файла шаблона;
- тип данных (сущность), если он еще не задан для отчета;
- атрибуты сущности, которые должны попасть в отчет;
- формат файла шаблона, по умолчанию выбран MSExcel.

![Images 116](/uploads/part-3/images-116.png "Images 116")

После того как пользователь задал все параметры для шаблона и нажал кнопку “Ok”, формируется шаблон выбранного формата с выбранными атрибутами сущности и открывается в ассоциированном с типом
файла приложении и доступен для редактирования.

Если выбран один из MSOffice форматов (MSWordили MSExcel) и на компьютере установлена версия MSOffice2003 или выше, то после формы задания параметров нового шаблона, отображается диалог выбора
типа шаблона.

![Images 117](/uploads/part-3/images-117.png "Images 117")

Версии начиная с 2003 поддерживают документы, которые представляют собой xml-файлы. Они используются наравне с обычными типами файлов для этих приложений *.doc и *.xls.

Для MSWord это XML Document (*.xml) файлы, дляMSExcel – XML Spreadsheet (*.xml) файлы. Поэтому пользователю предоставляется выбор, шаблон какого типа будет генерироваться.

## Закладка «Данные»

На закладке “Данные” определяется, откуда и какие данные будут выводиться в отчет.

В поле “Формирование данных” выбирается каким способом формируются данные для отчета.

Системой поддерживается два способа формирования данных:


- Выборка данных из БД – путем формирования запроса к БД (используется по умолчанию);
- Выполнение скрипта – путем запуска скрипта из файла.

![Images 118](/uploads/part-4/images-118.png "Images 118")

Назначение кнопок закладки “Атрибуты”:

- ![Images 119](/uploads/part-3/images-119.png "Images 119") Выделить все - Выбирается текущий атрибут. Если текущий атрибут является родительским или дочерним, то автоматически выделяются все простые атрибуты нижнего уровня. Если текущий атрибут является простым, то выделяются все простые атрибуты текущего уровня.
- ![Images 120](/uploads/part-3/images-120.png "Images 120") Убрать все отметки о выделении - Снимается выбор со всех атрибутов
- ![Images 121](/uploads/44/images-121.png "Images 121") Включает/выключает показ вычисляемых атрибутов. Кнопка является переключающей. По умолчанию показ вычисляемых атрибутов выключен.

Закладка “Сортировка” используется для сортировки данных запрашиваемых в базе данных. Из левого окна закладки в правое (при помощи кнопок “Стрелка влево” и “Стрелка вправо”) переносятся атрибуты,
используемые при сортировке. Соответствующая сортировка (по возрастанию или убыванию) отображается с помощью иконки. Поменять направление сортировки можно либо двойным щелчком по атрибуту, либо с
помощью кнопок.

![Images 122](/uploads/44/images-122.png "Images 122")

Назначение кнопок закладки “Сортировка”:

- ![Images 123](/uploads/44/images-123.png "Images 123") Сортировать по возрастанию
- ![Images 124](/uploads/44/images-124.png "Images 124") Сортировать по убыванию
- ![Images 125](/uploads/44/images-125.png "Images 125") Переместить атрибут выше - Задает порядок следования обработки атрибутов при сортировке их значений. (Повышает приоритет атрибута)
- ![Images 126](/uploads/44/images-126.png "Images 126") Переместить атрибут ниже - Задает порядок следования обработки атрибутов при сортировке их значений. (Понижает приоритет атрибута)

## Закладка «Права»

На этой закладке назначаются права на отчет для ролей. Роль может выполнять либо только “Формирование”, либо “Редактирование и формирование” отчета. 

Редактирование подразумевает, что пользователь может изменять все атрибуты отчета: наименование, фильтр и др. Роль обладающая правами “Формирование” может только сформировать отчет. 

Пользователь, не обладающий ни одной ролью имеющей право “Редактирование и формирование” на отчет при открытии его формы видит параметры, но не может изменить их значения. Доступной остается только кнопка “Сформировать”.

![Images 127](/uploads/44/images-127.png "Images 127")

# Настройка данных ЛПУ
Вся информация по лечебно-профилактическому учреждению находится в папке с названием текущего ЛПУ пользователя: наименование, код ЛПУ, код ОГРН, адрес, филиалы (наименование, адрес, контактные телефоны), договора со страховыми компаниями,диапазон номеров для выписки ДЛО. 

![Images 128](/uploads/44/images-128.png "Images 128")

Здесь же добавляются и редактируются отделения ЛПУ. Градация сотрудников по отделениям, заведение кабинета (заводится при приеме пациентов в определенном кабинете без привязки к конкретному врачу), указание
плана посещений на кабинет, источника финансирования и типа отделения. 

Папка «участки» дает возможность просматривать и редактировать сведения для участков ЛПУ, добавлять участкового врача, указывать аптеки для выписки ДЛО. На вкладке «критерии» настройками фильтра ограничивается прикрепление для данного участка. Папка «паспорта участков» упрощает поиск пациентов и сопутствующих данных по участкам, а также прикрепленных к ЛПУ пользователя.

На вкладке «Общая информация» ввести информацию о данном лечебном учреждении. Для того, чтобы добавить адрес нажать «Добавить» и заполнить все открывшиеся поля.

![Images 129](/uploads/44/images-129.png "Images 129")

Для добавления нового филиала на форме «Филиалы» нажать «Добавить». В открывшейся форме добавить информацию о филиале. Добавить адрес филиала и контактные телефоны регистратуры.

![Images 130](/uploads/44/images-130.png "Images 130")

Для того чтобы добавить отделение нажать «Добавить» на вкладке «Отделения». При добавлении отделения необходимо заполнить: наименование отделения, полное наименование отделения, адрес, телефон, код отделения, источник финансирования, тип отделения, код в ТФОМС.

Для выбора подразделения воспользоваться справочником, ссылка на который указана в конце поля «Подразделение».

![Images 131](/uploads/part-4/images-131.png "Images 131")

Также в отделение нужно указать сотрудников. Нажать Добавить на вкладке «Сотрудники». В открывшейся форме, на вкладке «Общие данные» заполнить информацию о сотрудниках. (СМ.
РЕГИСТРАЦИЯ СОТРУДНИКА).

Для добавления кабинета нажать «Добавить» (заводится при приеме пациентов в определенном кабинете без привязки к конкретному врачу).

![Images 132](/uploads/part-4/images-132.png "Images 132")

Указать планы посещений на кабинет: на вкладке «План посещений» нажать «Добавить», в открывшейся форме заполнить план посещений на год поквартально.

![Images 133](/uploads/part-4/images-133.png "Images 133")

## Паспорта участков
Папка «паспорта участков» упрощает поиск пациентов и сопутствующих данных по участкам, а также прикрепленных к ЛПУ пользователя.

В папке «Список пациентов» отображается полный список пациентов данного лечебного учреждения.

![Images 134](/uploads/part-4/images-134.png "Images 134")

В папках: «Инвалиды», «Льготники», «Состоящие на ДУ» категории пациентов сгруппированы по папкам. При открытии папки отображается полный список пациентов данной категории.

![Images 135](/uploads/part-4/images-135.png "Images 135")

Папка «Филиалы» открывает филиалы данного лечебного учреждения.

![Images 136](/uploads/part-4/images-136.png "Images 136")

Для создания нового участка необходимо зайти в папку «Участки». Нажать правой кнопкой мыши на белом поле, в открывшейся форме нажать «Новый».

![Images 137](/uploads/part-4/images-137.png "Images 137")

Указать: номер участка, профиль, отделение.

Для того чтобы добавить участкового врача на вкладке «Участковый» нажать «Добавить». В открывшейся форме выбрать врача и мед.сестру из справочника, ссылка на который представлена в конце строки, указать дату начала и дату окончания.

![Images 138](/uploads/part-4/images-138.png "Images 138")

На вкладке «Адреса» для добавления адреса нажать «Добавить». В открывшейся форме ввести адрес.

![Images 139](/uploads/part-4/images-139.png "Images 139")

Для добавления дома,корпуса,квартиры нажать «Добавить» на форме справа.

![Images 140](/uploads/part-4/images-140.png "Images 140")

На вкладке «Критерии»

![Images 141](/uploads/part-5/images-141.png "Images 141")

Добавление аптеки, привязанной к участку, на вкладке «Аптеки» нажать «Добавить» и выбрать нужную аптеку из справочника, ссылка на который предоставлена в конце поля.

![Images 142](/uploads/part-5/images-142.png "Images 142")

На вкладке «Пункты ДМК» добавить пункт ДМК нажатием кнопки «Добавить», далее выбрать пункт ДМК из справочника, ссылка на который предоставлена в конце строки.

![Images 143](/uploads/part-5/images-143.png "Images 143")

В папке «Филиалы» отражена информация о филиалах данного ЛПУ. Выбрав филиал можно посмотреть информацию об участках и пациентах данного филиала по определенным категориям.

В папке «Список пациентов» отображается список пациентов данного участка.

![Images 144](/uploads/part-5/images-144.png "Images 144")

В папке «Должности» отображается список всех сотрудников данного лечебного учреждения. Для создания новой должности нажать правой кнопкой мыши и выбрать пункт «Новый». (см. создание сотрудника)

В папке «Места приема» отображается информация о кабинетах. Для создания нового кабинета нажать правой кнопкой мыши и выбрать пункт «Новый». В открывшейся форме указать код (номер кабинета), описание, филиал.

![Images 146](/uploads/part-5/images-146.png "Images 146")

# Формирование счетов-реестров

Для формирования счетов реестров необходимо подключить клиентский модуль "AKUZ.Client.SchetReestrClientModule, AKUZ.Client"

1. Зайти в папку "Администрирование"
1. Открыть папку "Клиентские модули"
1. В открывшемся окне назать на рабочую область правой кнопкой мыши и в контекстном меню выбрать "Новый"
1. "Тип Net" выбрать "AKUZ.Client.SchetReestrClientModule, AKUZ.Client"
1. Описание "Модуль формирования счетов реестров"
1. Приоритет загрузки "9"
1. Сохранить и перезапустить клиент
1. После перезапуска в папке "Взаиморасчеты" появится папка "Реестры счетов"

в папке «программы страхования»

![Images 147](/uploads/part-5/images-147.png "Images 147")

выбрать ТП ОМС соответствующего года; указать дату завершения действительности программы;

![Images 148](/uploads/part-6/images-148.png "Images 148")

проставить индивидуальный коэффициент лечебного учреждения

![Images 149](/uploads/part-6/images-149.png "Images 149")

![Images 150](/uploads/part-6/images-150.png "Images 150")

## Заполнение дополнительных полей
Указать код МО на вкладке «общая информация» о лечебном учреждении.

![Images 151](/uploads/part-6/images-151.png "Images 151")

У сотрудника необходимо проставить СНИЛС

![Images 152](/uploads/part-6/images-152.png "Images 152")

На форме должности необходимо проставить в соответствие с приказом: профиль мед. помощи (фед.), специальность (фед.)

![Images 153](/uploads/part-6/images-153.png "Images 153")

Наименование отделения должно содержать не более 15 символов.

![Images 154](/uploads/part-6/images-154.png "Images 154")

В персональных данных пациента появилось новое поле «место рождения», которое заполняется по данным паспорта. Обязательно для заполнения иногородних застрахованных пациентов.

![Images 155](/uploads/part-6/images-155.png "Images 155")

папке «Взаиморасчеты» открыть подпапку «Реестры-счетов».

![Images 156](/uploads/part-6/images-156.png "Images 156")

Правой кнопкой мыши создать новый счет-реестр

![Images 157](/uploads/part-6/images-157.png "Images 157")

Заполнить поля: код (уникальный номер), номер, месяц, год, дату выставления, выбрать программу страхования.

![Images 158](/uploads/part-6/images-158.png "Images 158")

Нажать кнопку «сформировать»

![Images 159](/uploads/part-6/images-159.png "Images 159")

Сохранить сформированный файл в формате (.ХМL)

![Images 160](/uploads/part-6/images-160.png "Images 160")

**Важно:** 
На форме «фильтр программы страхования» указываются условия выборки элементов по данной категории счетов-реестров

На форме «фильтр доп.» в случае необходимости добавления дополнительных условий на данный счет-реестр, составляется фильтр. дополняющий основное условие программы страхования.

Критичные ошибки по сформированному счет-реестру, по элементам не удовлетворяющим условиям программы страхования выводятся в формате (.xls)

Элементы счет-реестра с некорректными данными выводятся по нескольким разделам и выделяются красным цветом

- «лекарства» - данные по выписанным рецептам
- «записи» - данные по пациентам
- «случаи» - данные по посещениям пациента «услуги» - данные по услугам/посещениям

